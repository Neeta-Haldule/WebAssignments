function PM2FileAttachmentComponent(a){this.register();this._init(a)}
(function(){juic.extend(PM2FileAttachmentComponent,juic.Component,{_init:function(a){this._baseModel=a;this._attachmentModel=new PM2FileAttachmentModel(this._baseModel);this._attachmentModel.addEventListener("gotDeleteAttachmentStatus",this);this._attachmentModel.addEventListener("gotUpdateAttachmentNameSatus",this);this._attachmentModel.addEventListener("updateAttachmentNameFailure",this);this._attachmentModel.addEventListener("deleteAttachmentFailure",this);this._attachmentListComponent=new PM2FileAttachmentListComponent(this._attachmentModel);
this._attachmentListComponent.addEventListener("deleteAttachment",this);this._attachmentListComponent.addEventListener("updateAttachmentName",this)},renderHtml:function(a){a.push("\x3cdiv id\x3d'",this.id,"attchmentSection'\x3e");a.push("\x3cdiv class\x3d'pmSupportingTitle' tabIndex\x3d0\x3e");a.push("\x3cspan\x3e",MSGS.PERFORMANCE_PM_DOCUMENTS,"\x3c/span\x3e");this._attachmentModel.hasUploadPermission()&&a.push("\x3cspan class\x3d'pmAttachmentButton' role\x3d'button' tabIndex\x3d0 title\x3d'",MSGS.PERFORMANCE_FILE_ATTACHMENT_TITLE,
"' aria-label\x3d'",MSGS.PERFORMANCE_FILE_ATTACHMENT_TITLE,"' onkeypress\x3d'",this.fireCode("_handleSupportingAttachmentKeyPress"),";return false;' onclick\x3d'",this.fireCode("_addDocuments"),"'\x3e\x3c/span\x3e");a.push("\x3c/div\x3e");this._attachmentListComponent.renderHtml(a);a.push("\x3c/div\x3e")},_upload:function(){this._fileUpload.doUpload()},_handleSupportingAttachmentKeyPress:function(a){var b=SFDOMEvent.getCharCode(a);if(b===SFDOMEvent.KEY_CODE.RETURN||b===SFDOMEvent.KEY_CODE.SPACE)a.preventDefault(),
this._addDocuments(a)},_addDocuments:function(){var a={formDataId:formConfig.formDataId,module:"perfmgt",attachmentType:"PERFORMANCE_ATTACHMENT",fileFormats:MSGS.PERFORMANCE_PM_ATTACHMENTS_TYPES_ARR},b="\x3cdiv\x3e"+sfMessageFormat.format(MSGS.PERFORMANCE_PM_ATTACHMENT_FILE_TYPES_TEXT,"\x3c/div\x3e\x3cdiv\x3e"+MSGS.PERFORMANCE_PM_ATTACHMENTS_TYPES_ARR.replace(/\|/gi,", "))+"\x3c/div\x3e";this._fileUpload=new SFFileUploadDialog("pmAttachmentController",!1,1,a,MSGS.PERFORMANCE_FILE_ATTACHMENT_TITLE,
550,225,b,!0,!0);this._fileUpload.addEventListener("uploadSucceeded",this);this._fileUpload.addEventListener("hide",this,"_handleFileUploadHide");SFOverlayMgr.showOverlay(this._fileUpload,!0);this.dispatch("handleFileUploadDialog",{status:!1})},_handleFileUploadHide:function(a){this.dispatch("handleFileUploadDialog",{status:!0})},handleEvent:function(a){switch(a.type){case "uploadSucceeded":a=a.response.result;this._attachmentModel.appendAttachmentToBase(a);this._attachmentListComponent.appendRow(a,
!0);SFOverlayMgr.removeOverlay(this._fileUpload.id);this.dispatch("updateAttachementCount");break;case "deleteAttachment":this._attachmentModel.deleteAttachment(a.attachmentId);break;case "updateAttachmentName":this._attachmentModel.renameAttachment(a.attachmentId,a.attachmentName);break;case "deleteAttachmentFailure":this._attachmentListComponent.handleDeleteFailure(a.attachmentId,a.errMsg);break;case "updateAttachmentNameFailure":this._attachmentListComponent.handleUpdateNameFailure(a.attachmentId,
a.errMsg);break;case "gotUpdateAttachmentNameSatus":a.statusVO&&0===a.statusVO.status?this._attachmentListComponent.updateAttachmentName(a.statusVO.attachmentId):this._attachmentListComponent.handleUpdateNameFailure(a.statusVO.attachmentId,MSGS.PERFORMANCE_FILE_ATTACHMENT_RENAME_FAIL);break;case "gotDeleteAttachmentStatus":a.statusVO&&0===a.statusVO.status?(this._attachmentModel.deleteAttachmentBaseModel(a.statusVO.attachmentId),this._attachmentListComponent.deleteAttachmentRow(a.statusVO.attachmentId),
this.dispatch("updateAttachementCount")):this._attachmentListComponent.handleDeleteFailure(a.statusVO.attachmentId,MSGS.PERFORMANCE_FILE_ATTACHMENT_DELETE_FAIL)}}})})();function PM2FileAttachmentListComponent(a){this.register();this._init(a)}
(function(){juic.extend(PM2FileAttachmentListComponent,juic.Component,{_init:function(a){this._model=a;this._componentMap={}},renderHtml:function(a){a.push("\x3cdiv id\x3d'",this.id,"_attachmentListContainer' calss\x3d'attachmentListContainer'\x3e");var b=this._model.getAttachementList();if(b)for(var c=0;c<b.length;c++)this.addRow(a,b[c]);a.push("\x3c/div\x3e")},addRow:function(a,b,c){if(c||b.editPerm||b.readPerm)c=this._getAttachmentListItem(b,c),this._componentMap[b.attachmentId]=c,a.push("\x3cdiv id\x3d'",
this._getContainerId(b.attachmentId),"'\x3e"),c.renderHtml(a),a.push("\x3c/div\x3e")},appendRow:function(a,b){var c=juic.createRenderContext(),d=juic.$(this.id+"_attachmentListContainer");if(this._model.getAttachementList()&&1<this._model.getAttachementList().length){var e=this._getAttachmentListItem(a,b);this._componentMap[a.attachmentId]=e;e.renderHtml(c);newElement=document.createElement("div");newElement.id=this._getContainerId(a.attachmentId);newElement.innerHTML=c.join("");(c=d.firstChild)&&
d.insertBefore(newElement,c)}else d&&(this.addRow(c,a,b),c.renderInto(d))},_getAttachmentListItem:function(a,b){var c=new AttachmentListItem(a,b||!1);c.addEventListener("deleteAttachment",this);c.addEventListener("updateAttachmentName",this);return c},_getContainerId:function(a){return a+"_rowItemContainer"},deleteAttachmentRow:function(a){a=juic.$(this._getContainerId(a));a.parentNode.removeChild(a)},updateAttachmentName:function(a){var b=this._getAttachmentComponent(a);b&&(b.updateAttachmentName(),
this._model.updateAttachmentNameBaseModel(a,b.getAttachmentName()))},handleUpdateNameFailure:function(a,b){var c=this._getAttachmentComponent(a);c&&c.handleUpdateNameFailure(b)},_viewAttachmet:function(a){window.open(a,"pmattachment","scrollbars,resizable,height\x3d480,width\x3d730")},handleDeleteFailure:function(a,b){var c=this._getAttachmentComponent(a);c&&c.handleDeleteFailure(b)},_getAttachmentComponent:function(a){return this._componentMap[a]},handleEvent:function(a){switch(a.type){case "deleteAttachment":this.dispatchEvent(a);
break;case "updateAttachmentName":this.dispatchEvent(a)}}})})();function PM2FileAttachmentModel(a){this._baseModel=a;this._init()}
(function(){juic.extend(PM2FileAttachmentModel,juic.EventTarget,{_init:function(){this._pmAttachmentController=AjaxService.getMBeanInstance("pmAttachmentController")},hasUploadPermission:function(){return this._baseModel.uploadPerm},getAttachementList:function(){return this._baseModel.attachmentsList},appendAttachmentToBase:function(a){this._baseModel.attachmentsList.push(a)},deleteAttachment:function(a){var b={model:this,callback:function(a){b.model.dispatch("gotDeleteAttachmentStatus",{statusVO:a})},
exceptionHandler:function(c,d){b.model.dispatch("deleteAttachmentFailure",{attachmentId:a,errMsg:d.message,action:"Unable to delete attachment"})}};this._pmAttachmentController.deleteAttachment(a,b)},deleteAttachmentBaseModel:function(a){var b=this.getAttachementList();a=this._getAttachmentItemIndex(a);null!==a&&b.splice(a,1)},_getAttachmentItemIndex:function(a){for(var b=0,c=this.getAttachementList(),d=c.length;b<d&&c[b].attachmentId!==a;b++);return b},renameAttachment:function(a,b){var c={model:this,
callback:function(a){c.model.dispatch("gotUpdateAttachmentNameSatus",{statusVO:a})},exceptionHandler:function(b,e){c.model.dispatch("updateAttachmentNameFailure",{attachmentId:a,errMsg:e.message,action:"Unable to delete attachment"})}};this._pmAttachmentController.renameAttachment(a,b,c)},updateAttachmentNameBaseModel:function(a,b){var c=this._getAttachmentItemIndex(a);if(c=this.getAttachementList()[c])c.name=b}})})();function AttachmentListItem(a,b){this.register();this._init(a,b)}
(function(){juic.extend(AttachmentListItem,juic.Component,{_init:function(a,b){this._attachmentItem=a;this._isEdit=this._attachmentItem.editPerm;this._isReadOnly=this._attachmentItem.readPerm;this._isEditMode=b;this.isAttachmentNameValid=!0;this._attachmentName=new SFInput("attachmentName",this._attachmentItem.name);this._attachmentName.addEventListener("action",this);this._attachmentView=new SFSimpleLink(this._attachmentItem.name,"click_attachmentDownload");this._attachmentView.addEventListener("action",
this);this._attachmentOk=new SFSimpleLink(MSGS.COMMON_Ok,"click_attachmentRenameOk");this._attachmentOk.addEventListener("action",this);this._attachmentCancel=new SFSimpleLink(MSGS.COMMON_Cancel,"click_attachmentRenameCancel");this._attachmentCancel.addEventListener("action",this);this._attachmentDelete=new SFSimpleLink(MSGS.COMMON_Delete,"click_attachmentDelete");this._attachmentDelete.addEventListener("action",this);this._attachmentEdit=new SFSimpleLink(MSGS.COMMON_Edit,"click_attachmentEdit");
this._attachmentEdit.addEventListener("action",this)},_getAttachmentId:function(){return this._attachmentItem?this._attachmentItem.attachmentId:""},getAttachmentName:function(){return this._attachmentName.getValue()},renderHtml:function(a){a.push("\x3cdiv id\x3d'",this.id,"_attachmentRow' class\x3d'attachmentRowItem'\x3e");a.push("\x3cdiv id\x3d'",this.id,"_attachmentLoading' class\x3d'attachmentLoadingImg attachmentLoadingPadding' style\x3d'display:none;'\x3e\x3c/div\x3e");a.push("\x3cdiv id\x3d'",
this.id,"_attachmentActionErrorInfo' class\x3d'attachmentActionInfo' style\x3d'display:none;'\x3e \x3c/div\x3e");a.push("\x3cdiv id\x3d'",this._getAttachmentRowContainerId(),"' class\x3d'attachmentRowContainer'\x3e");this._renderAttachmentActionItems(a);a.push("\x3cdiv\x3e\x3cspan class\x3d'createdBy'\x3e",sfMessageFormat.format(MSGS.PERFORMANCE_FILE_ATTACHMENT_CREATED_BY,juic.escapeHTML(this._attachmentItem.userName),juic.escapeHTML(this._attachmentItem.createdDate))," \x3c/span\x3e\x3c/div\x3e");
a.push("\x3c/div\x3e\x3c/div\x3e")},_renderAttachmentActionItems:function(a){a.push("\x3cdiv id\x3d'",this.id,"_attachmentNameContainer' class\x3d'attachmentNameContainer' \x3e");this._isEdit&&this._isEditMode&&this._attachmentName.renderHtml(a);this._isEditMode||!this._isReadOnly&&!this._isEdit||this._attachmentView.renderHtml(a);a.push("\x3c/div\x3e");a.push("\x3cdiv id\x3d'",this.id,"_attachmentActionContainer' class\x3d'attachmentLinkContainer' \x3e");this._isEdit&&(this._isEditMode?this._renderEditControles(a):
this._renderEditAttachmentLink(a));a.push("\x3c/div\x3e")},_renderEditControles:function(a){a.push("\x3cspan id\x3d'",this.id,"_attachmentOkContainer' \x3e");this._attachmentOk.renderHtml(a);a.push("\x3c/span\x3e");a.push("\x3cspan id\x3d'",this.id,"_attachmentCancelContainer '\x3e");this._attachmentCancel.renderHtml(a);a.push("\x3c/span\x3e");a.push("\x3cspan id\x3d'",this.id,"_attachmentDeleteContainer'\x3e");this._attachmentDelete.renderHtml(a);a.push("\x3c/span\x3e")},_renderEditAttachmentLink:function(a){a.push("\x3cspan id\x3d'",
this.id,"_attachmentEditContainer'\x3e");this._attachmentEdit.renderHtml(a);a.push("\x3c/span\x3e")},_viewAttachmet:function(){window.open(this._attachmentItem.attachmentURL,"pmattachment","scrollbars,resizable,height\x3d480,width\x3d730")},_getAttachmentActionContainer:function(){return juic.$(this.id+"_attachmentActionContainer")},_getAttachmentNameContainer:function(){return juic.$(this.id+"_attachmentNameContainer")},_handleEditAction:function(){var a=this._getAttachmentNameContainer();if(a){var b=
juic.createRenderContext();this._attachmentName.renderHtml(b);b.renderInto(a)}if(a=this._getAttachmentActionContainer())b=juic.createRenderContext(),this._renderEditControles(b),b.renderInto(a)},_handleCancelAction:function(){this._reRenderDownloadLink();this._reRenderEditAttachmentLink()},_handleOkAction:function(){this._validateFileName()&&(this._showAttachmetControles(!1),this._showAttachmetLoading(!0),this.dispatch("updateAttachmentName",{attachmentId:this._getAttachmentId(),attachmentName:this._attachmentName.getValue()}))},
_validateFileName:function(){if(this._attachmentName.getValue().trim())return!0;this._showAttachmentActionErrorInfo(!0,"Please enter the valid name");return!1},_handleDeleteAction:function(){juic.$(this._getAttachmentRowContainerId()).style.display="none";juic.$(this.id+"_attachmentLoading").style.display="";this.dispatch("deleteAttachment",{attachmentId:this._getAttachmentId()})},_getAttachmentRowContainerId:function(){return this.id+"_attachmentRowContainer"},handleUpdateNameFailure:function(a){this.handleDeleteFailure(a)},
handleDeleteFailure:function(a){this._showAttachmetLoading(!1);var b=this;this._timer=setTimeout(function(){b._showAttachmentActionErrorInfo(!0,a)},5E3);this._showAttachmetControles(!0)},_showAttachmentActionErrorInfo:function(a,b){var c=juic.$(this.id+"_attachmentActionErrorInfo");c&&(a?(c.style.display="",c.innerHTML=juic.escapeHTML(b)):c.style.display="none")},_showAttachmetLoading:function(a){var b=juic.$(this.id+"_attachmentLoading");b&&(b.style.display=a?"":"none")},_showAttachmetControles:function(a){var b=
juic.$(this._getAttachmentRowContainerId());b&&(b.style.display=a?"":"none")},_reRenderDownloadLink:function(){var a=this._getAttachmentNameContainer();if(a){var b=juic.createRenderContext();this._attachmentView.renderHtml(b);b.renderInto(a)}},_reRenderEditAttachmentLink:function(){var a=this._getAttachmentActionContainer();if(a){var b=juic.createRenderContext();this._renderEditAttachmentLink(b);b.renderInto(a)}},updateAttachmentName:function(){this._showAttachmetLoading(!1);this._showAttachmetControles(!0);
var a=this._attachmentName.getValue();this._attachmentView.setLabel(a);this._reRenderDownloadLink();this._reRenderEditAttachmentLink()},handleEvent:function(a){switch(a.actionCommand){case "click_attachmentRenameOk":this._handleOkAction();break;case "click_attachmentRenameCancel":this._handleCancelAction();break;case "click_attachmentDelete":this._handleDeleteAction();break;case "click_attachmentEdit":this._handleEditAction();break;case "click_attachmentDownload":this._viewAttachmet();break;case "blur":this._validateFileName()}}})})();