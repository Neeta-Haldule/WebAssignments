function PMRatingLabel(a,b,d){this.register();this.label=a;this.forId=b?b:"";this.options=d?d:{};this.cssClass=this.options.cssClass?this.options.cssClass:"subtitle"}
(function(){extend(PMRatingLabel,PM2Label,{_handleKeyPress:function(a){13==(a.which||a.keyCode)&&this._handleClick(a);PM2DialogUtil.stopEvent(a)},_handleClick:function(a){var b=this.options.ratingScale,d=b.m.getData(b.path),b=new PM2RatingScaleDescription(b),c="rating_help_"+this.id;(new SFCalloutPopup({originOptions:{pointerOffset:40},closeOnMouseout:!1,showCloseIcon:!0,originId:c,refocusRef:juic.$(c),title:null==d.scaleNameInUserLocale?d.scaleName:d.scaleNameInUserLocale,content:b})).show(c,{setFocusOnSelf:!0});
PM2DialogUtil.stopEvent(a)},renderHtml:function(a){a.push('\x3clabel  id\x3d"',this.id,'" class\x3d"',this.cssClass,'" for\x3d"',this.forId,'"\x3e');this.options.required&&(a.push('\x3cspan title\x3d"',MSGS.COMMON_Required,'" class\x3d"requiredMark"\x3e'),a.push("* "),a.push("\x3c/span\x3e"));a.push(escapeHTML(this.label));this.options.ratingScale&&this.label&&this.options.isShowRatingHelpIcon&&a.push('\x3cspan role\x3d"button" aria-haspopup\x3d"true" tabIndex\x3d0  aria-label\x3d"',MSGS.PERFORMANCE_PM2_RATING_HELP_ICON_TITLE,
'" title\x3d"',MSGS.PERFORMANCE_PM2_RATING_HELP_ICON_TITLE,'" id \x3d "rating_help_',this.id,'" class\x3d "sapIcon pmHelpIcon" onkeypress\x3d"',this.fireCode("_handleKeyPress"),'" onclick\x3d"',this.fireCode("_handleClick"),'" \x3e\x26#xe1c4;\x3c/span\x3e');a.push("\x3c/label\x3e")}})})();function MLTRatingLabel(a,b,d){this.register();this.label=a;this.forId=b?b:"";this.options=d?d:{};this.cssClass=this.options.cssClass?this.options.cssClass:"subtitle"}
(function(){extend(MLTRatingLabel,PM2Label,{renderHtml:function(a){a.push('\x3clabel  id\x3d"',this.id,'" class\x3d"',this.cssClass,'" for\x3d"',this.forId,'"\x3e');a.push(escapeHTML(this.label));a.push("\x3c/label\x3e")}})})();
function PM2RatingScaleDescription(a){this.register();this.m=a.m;this.scalePath=a.path+"/scaleValues";this._scale=this.m.getData(a.path);this._scale.loaded||(this.dao=this.m.getDao(),this.dao.getRatingScaleDesc(this._scale.scaleName,this._scale.reverseScale),this.dao.addEventListener("loadRatingScaleDescSuccess",this),this.bindProperty(this.m,this.scalePath));this._isShowValue=this._scale.showValue}
PM2RatingScaleDescription.prototype=function(){return set(new BaseControl,{setScaleDesc:function(a){this._scale.scaleValues=a},updateBinding:function(){var a=this.m.getData(this.scalePath);this.setScaleDesc(a);this.refresh()},cleanup:function(){this.unBinding(this.m,this.scalePath);this.unregister()},_buildList:function(){var a=[];a.push('\x3cul class \x3d "ratingDescWrapper"\x3e');var b=null==this._scale?[]:this._scale.scaleValues;if(this._scale.loaded)for(var d=b.length,c=0;c<d;c++){if(0>b[c].value.indexOf("-1971")&&
0>b[c].value.indexOf("-1972")){var e=this._isShowValue?b[c].value+" "+b[c].desc:b[c].desc;b[c].longDesc?(a.push('\x3cli\x3e\x3cdiv class\x3d"ratingValue"\x3e',juic.escapeHTML(e),":\x3c/div\x3e"),a.push("\x3cdiv\x3e",juic.escapeHTML(b[c].longDesc),"\x3c/div\x3e")):a.push('\x3cli\x3e\x3cdiv class\x3d"ratingValue"\x3e',juic.escapeHTML(e),"\x3c/div\x3e");a.push("\x3c/li\x3e")}}else b=new SFLoading(" "),a.push('\x3cli class \x3d "loading_thrub"\x3e'),b.renderHtml(a),a.push("\x3c/li\x3e");a.push("\x3c/ul\x3e");
return a.join("")},renderHtml:function(a){a.push('\x3cdiv id \x3d "',this.id,'" class \x3d "ratingScaleDesc"\x3e');a.push(this._buildList());a.push("\x3c/div\x3e")},handleEvent:function(a){switch(a.type){case "loadRatingScaleDescSuccess":var b=this.scalePath,d=b.substring(0,b.lastIndexOf("/"))+"/loaded",c=a.data;a=this.m.getData(b);a=a.splice(0,a.length);for(var c=c.scaleValues,e=0,f=a.length;e<f;e++)for(var g=0,h=c.length;g<h;g++)if(a[e].value==c[g].value){a[e].longDesc=c[g].longDesc;c.splice(g,
1);break}this.m.setData(d,!0);this.m.setData(b,a);this.dao.removeEventListener("loadRatingScaleDescSuccess",this)}},refresh:function(){var a=gebi(this.id);null!=a&&(a.innerHTML="",a.innerHTML=this._buildList())}})}();function PM2ItemWeight(a,b,d,c,e,f){this.register();this._init(a,b,d,c,e,f)}
(function(){juic.extend(PM2ItemWeight,BaseControl,{_init:function(a,b,d,c,e,f){this._eleId=a;this._editable=d;this._weight=b||0;this._weightSymbol=f;this._editWeightId=this.id+"_editweight";this._weightId=this.id+"_weight";this._required=void 0==c?!1:c;this._type=e},renderHtml:function(a){this._editable?("behaviorWeight"==this._type?(a.push('\x3ca id\x3d"',this._weightId,'" href\x3d"javascript:;" onclick\x3d"',this.fireCode("_clickEditWeight"),' return false;"\x3e'),a.push(juic.escapeHTML(this._weight)),
a.push(juic.escapeHTML(this._weightSymbol),"\x3c/a\x3e")):(a.push('\x3cspan id\x3d"',this._weightId,'_weightLink" class\x3d"pmItemWeight" '," \x3e"),this._required&&a.push('\x3cspan class\x3d"requiredMark"\x3e* \x3c/span\x3e'),a.push('\x3cspan id\x3d"',this._weightId,'"\x3e',sfMessageFormat.format(MSGS.PERFORMANCE_PMU_WEIGHT_OF_TOTAL,juic.escapeHTML(this._weight),juic.escapeHTML(this._weightSymbol)),"\x3c/span\x3e"),a.push('\x3cspan tabIndex\x3d0 role\x3d"button" class\x3d"sapIcon editWeightIcon" id\x3d"'+
this._editWeightId+'"',' title\x3d"',MSGS.PERFORMANCE_PMU_EDIT_WEIGHT,'" ',' aria-label\x3d"',MSGS.PERFORMANCE_PMU_EDIT_WEIGHT,'" aria-describedby\x3d"',this._weightId,'"',' onclick\x3d"',this.fireCode("_clickEditWeight"),' return false;" ',' onkeypress\x3d"',this.fireCode("_hanldeEditWeightOnKeyPress"),' return false;"',"\x3e\x26#xe038;\x3c/span\x3e"),a.push("\x3c/span\x3e")),a.push('\x3cinput type\x3d"hidden" value\x3d"',juic.escapeHTML(this._weight),'" name\x3d"',this._eleId,'" id\x3d"',this._eleId,
'"\x3e')):"behaviorWeight"==this._type?a.push(juic.escapeHTML(this._weight),juic.escapeHTML(this._weightSymbol)):(a.push('\x3cspan class\x3d"pm2ItemWeight" id\x3d"',this._weightId,'"\x3e'),a.push(sfMessageFormat.format(MSGS.PERFORMANCE_PMU_WEIGHT_OF_TOTAL,juic.escapeHTML(this._weight),juic.escapeHTML(this._weightSymbol))),a.push("\x3c/span\x3e"))},_hanldeEditWeightOnKeyPress:function(a){var b=SFDOMEvent.getCharCode(a);if(b===SFDOMEvent.KEY_CODE.RETURN||b===SFDOMEvent.KEY_CODE.SPACE)a.preventDefault(),
this._clickEditWeight(a)},_handleKeyUp:function(a){13==(a.which||a.keyCode)&&this._clickEditWeight(a)},_clickEditWeight:function(a){var b={weightType:this._type,originalId:this._editWeightId};b.triggerElId=this._weightId+"_weightLink";this.dispatch("editWeights",b);PM2DialogUtil.stopEvent(a)},setHiddenInput:function(a){jQuery($(this._eleId)).val(a);PMUSaveUtils.autoSaveForm()},refresh:function(a){this._weight=a||0;var b=$(this._weightId);b&&(b.innerHTML=sfMessageFormat.format(MSGS.PERFORMANCE_PMU_WEIGHT_OF_TOTAL,
juic.escapeHTML(this._weight),juic.escapeHTML(this._weightSymbol)));this._editable&&this.setHiddenInput(a)},updateBinding:function(){if(this.oBinding){var a=this.oBinding.getModel().getData(this.oBinding.getPath());this._editable&&($(this._eleId).value=juic.escapeHTML(a),$(this._weightId).innerHTML="behaviorWeight"==this._type?juic.escapeHTML(a+this._weightSymbol):sfMessageFormat.format(MSGS.PERFORMANCE_PMU_WEIGHT_OF_TOTAL,juic.escapeHTML(a),juic.escapeHTML(this._weightSymbol)))}}})})();
function PM2SectWeight(a,b){this.register();this.m=a;this.weightFieldPath=b;this.init()}
(function(){juic.extend(PM2SectWeight,BaseControl,{init:function(){var a=this.m.getData(this.weightFieldPath);this.sectionIndex=PMPathUtil.getSectionIndex(this.weightFieldPath);this.m.getData(this.sectionIndex).hideWeightPercentSign?this.weightSymbol="":this.weightSymbol=window.formConfig.weightSymbol;var b=a.key,d=a.value;"none"!=a.permission.name&&(this.sectWeightField=new PM2ItemWeight(b,d,"write"==a.permission.name?!0:!1,!1,"itemWeight",this.weightSymbol),this.sectWeightField.addEventListener("editWeights",
this),this.bindProperty(this.m,"/"+this.weightFieldPath+"/value"))},renderHtml:function(a){this.sectWeightField&&this.sectWeightField.renderHtml(a)},_editWeights:function(a){this.pm2EditWeight&&this.pm2EditWeight.removeEventListener("saveWeights",this);var b=this.weightFieldPath.substring(0,this.weightFieldPath.lastIndexOf("/")),b=b.substring(0,b.lastIndexOf("/"));this.pm2EditWeight=new PM2EditWeight(this.m,b,{title:MSGS.PERFORMANCE_PM2_EDIT_SECTION_WEIGHTS,dataKey:"sectionWeight",type:"inOCOCSummary",
weightSymbol:this.weightSymbol});this.pm2EditWeight.addEventListener("saveWeights",this);this.pm2EditWeight.show(a.triggerElId)},handleEvent:function(a){switch(a.type){case "editWeights":this._editWeights(a);break;case "saveWeights":this._saveWeights(a.weights)}},_saveWeights:function(a){for(var b=0,d=a.length;b<d;b++){var c=a[b];this.m.setData(c.datapath,c.weight)}},updateBinding:function(){this.weightField=this.m.getData(this.weightFieldPath);this.sectWeightField.refresh(this.weightField.value)}})})();
function PM2EditWeightCanvas(a,b,d){this.register();this._init(a,b,d)}
PM2EditWeightCanvas.prototype=function(){return set(new Component,{_init:function(a,b,d){this._m=a;this._weightSymbol=d&&d.weightSymbol;this._weights=b;this._options=d;this._editWeightDetail=new PM2EditWeightDetail(this._weights,this._weightSymbol);this._editWeightDetail.addEventListener("updateMessage",this);this._warnMsgId=this.id+"_warnmsg";this._errMsgId=this.id+"_errmsg";this._totalId=this.id+"_total";this._weightTotal=100;this._options&&this._options.weightTotal&&!isNaN(this._options.weightTotal)&&
(a=parseFloat(this._options.weightTotal),0<a&&(this._hasWeightTotal=!0,this._weightTotal=a));this._weightTotalEnforce=this._options&&"enforce"==this._options.weightTotalOption&&this._hasWeightTotal},renderHtml:function(a){a.push('\x3cdiv class\x3d"editWeightCanvas"\x3e');a.push(sfMessageFormat.format(MSGS.PERFORMANCE_PMU_EDIT_WEIGHTS_HINT_MESSAGE,juic.escapeHTML(this._weightTotal),juic.escapeHTML(this._weightSymbol)));a.push('\x3cdiv id\x3d"',this._warnMsgId,'" class\x3d"warnmsg"\x3e\x3c/div\x3e');
a.push('\x3cdiv id\x3d"',this._errMsgId,'" class\x3d"errmsg"\x3e\x3c/div\x3e');a.push('\x3cdiv class\x3d"weighthead" id\x3d"',this._totalId,'"\x3e');a.push(sfMessageFormat.format(MSGS.PERFORMANCE_PMU_EDIT_WEIGHTS_TOTAL_WEIGHTS_MESSAGE,this._getTotalWeights(),juic.escapeHTML(this._weightSymbol)));a.push("\x3c/div\x3e");a.push('\x3cdiv class\x3d"weightdetailcontent"\x3e');this._editWeightDetail.renderHtml(a);a.push("\x3c/div\x3e");a.push("\x3c/div\x3e")},_getTotalWeights:function(){for(var a=0,b=0,
d=this._weights.length;b<d;b++)this._weights[b]&&!isNaN(this._weights[b].weight)&&(a=AccurateFloatUtil.add(a,this._weights[b].weight));return a},handleEvent:function(a){switch(a.type){case "updateMessage":this._updateMessage(a.validNumber)}},_updateMessage:function(a){var b=this._editWeightDetail.getTotalWeight();$(this._totalId).innerHTML=sfMessageFormat.format(MSGS.PERFORMANCE_PMU_EDIT_WEIGHTS_TOTAL_WEIGHTS_MESSAGE,juic.escapeHTML(b),juic.escapeHTML(this._weightSymbol));var d=!0,c=$(this._errMsgId),
e=$(this._warnMsgId);a?this._weightTotalEnforce&&b!=this._weightTotal?(c.innerHTML=sfMessageFormat.format(MSGS.PERFORMANCE_PMU_EDIT_WEIGHTS_NOT_MATCH_MESSAGE,juic.escapeHTML(this._options.sectionName),juic.escapeHTML(this._weightTotal),juic.escapeHTML(this._weightSymbol)),c.style.display="block",e.style.display="none",d=!1):(c.style.display="none",!this._weightTotalEnforce&&this._hasWeightTotal&&b!=this._weightTotal?(e.innerHTML=sfMessageFormat.format(MSGS.PERFORMANCE_PMU_EDIT_WEIGHTS_NOT_MATCH_MESSAGE,
juic.escapeHTML(this._options.sectionName),juic.escapeHTML(this._weightTotal),juic.escapeHTML(this._weightSymbol)),e.style.display="block"):e.style.display="none"):(c.innerHTML=MSGS.COMMON_Enter_percent_value,c.style.display="block",e.style.display="none",d=!1);this.dispatch("weightChanged",{enableSaveButton:d})},getWeights:function(){return this._editWeightDetail.getWeights()}})}();function PM2EditWeightDetail(a,b){this.register();this._init(a,b)}
PM2EditWeightDetail.prototype=function(){return set(new Component,{_init:function(a,b){this._weights=a;this.weightSymbol=b;this._total=0},renderHtml:function(a){a.push('\x3col class\x3d"editWeightDetail"\x3e');for(var b=!0,d=0,c=this._weights.length;d<c;d++){var e=this._weights[d],f="none"==e.perm.name?!0:!1;a.push("\x3cli",f?' class\x3d"hide"':b?' class\x3d"first"':"","\x3e");a.push('\x3clabel class\x3d"name" for\x3d"',this.id,"_",d,'"\x3e',escapeHTML(e.title),"\x3c/label\x3e");a.push('\x3cinput onkeyup\x3d"',
this.fireCode("_handleKeyup"),'" size\x3d"6" maxlength\x3d"8"',' id\x3d"',this.id,"_",d,'" value\x3d"',e.weight||0,'"',"read"==e.perm.name?' disabled\x3d"disabled"':"","/\x3e",juic.escapeHTML(this.weightSymbol));a.push("\x3c/li\x3e");f||(b=!1)}a.push("\x3c/ol\x3e")},validate:function(){var a=/^[0-9]{1,3}[.]?[0-9]*$/;this._total=0;for(var b=!0,d=0,c=this._weights.length;d<c;d++){var e=$(this.id+"_"+d).value,e=e.replace(/^\s+/g,"").replace(/\s+$/g,"");if(a.exec(e)){if(e=parseFloat(e),0>e||100<e)b=!1}else b=
!1,e=0;this._total=AccurateFloatUtil.add(this._total,e)}return b},getTotalWeight:function(){return this._total},_handleKeyup:function(a){this.validate()?this.dispatch("updateMessage",{validNumber:!0}):this.dispatch("updateMessage",{validNumber:!1})},getWeights:function(){for(var a=0,b=this._weights.length;a<b;a++){var d=$(this.id+"_"+a).value,d=parseFloat(d);this._weights[a].weight=d||0}return this._weights}})}();
function PM2EditWeight(a,b,d){this.register();this.m=a;this.dataPath=b;this._title=d&&d.title||"";this._options=d;this._weights=this.getWeights()}
(function(){juic.extend(PM2EditWeight,juic.Component,{show:function(a){this.editWeightCanvas&&this.editWeightCanvas.removeEventListener("weightChanged",this);this.editWeightCanvas=new PM2EditWeightCanvas(this.m,this._weights,this._options);this.editWeightCanvas.addEventListener("weightChanged",this);this.dialog=new SFDialogBox({title:this._title,buttons:[{label:MSGS.COMMON_Cancel,eventName:"hide",active:!1},{label:MSGS.COMMON_Save,eventName:"saveWeights",active:!0,enabled:!1}],content:this.editWeightCanvas,
width:420,closeDialogOnEsc:!0});this.dialog.addEventListener("action",this);this.dialog.showDialog(!0,document.activeElement)},getWeights:function(){if(this._options&&this._options.type){for(var a=this.m.traverse(this.dataPath,[this._options.dataKey],[],{withPath:!0}),b=[],d=0;d<a.length;d++){var c=a[d],e={};if(c&&c._val){e._eleId=c._val.key;e.weight=null==c._val.value||""==c._val.value?0:parseFloat(c._val.value);e.perm=c._val&&c._val.permission;var f=c._path+"/value";"/"!=f.charAt(0)&&(f="/"+f);
e.datapath=f;c=c._path;c="inOCOCSummary"==this._options.type?c.substring(0,c.lastIndexOf("/"))+"/name":c.substring(0,c.lastIndexOf("/"))+"/sectName";e.title=this.m.getData(c)}b.push(e)}return b}a=this.m.getData(this.dataPath);b=[];for(d=0;d<a.length;d++){e=a[d];c={};if(f=e.itemWeightVO)c._eleId=f.key,c.weight=null==f.value||""==f.value?0:parseFloat(f.value),c.perm=f.permission;c.title=e.itemName;c.id=e.itemId;b.push(c)}return b},handleEvent:function(a){switch(a.type){case "weightChanged":a.enableSaveButton?
this.dialog.enableButton(1):this.dialog.disableButton(1);break;case "action":if("saveWeights"==a.actionCommand){a=this.editWeightCanvas.getWeights();this.dispatch("saveWeights",{weights:a,dataPath:this.dataPath});if(a=$("pfui_mod"))a.value="true";this.dialog.close()}}}})})();