(function(){function h(){window.ajaxSecKey&&window.pageHeaderJsonData?b.init():window.jQuery&&!k?jQuery(function(){k=!0;h()}):20>l++&&setTimeout(h,100)}var b=window.LastPageVisitedUtil={init:function(){if(b.isSkipRedirect()||!b.redirectToLastPageVisited()){b.setLastPageVisited();var a=b.getInitialLastPageVisited();a&&b.setLastPageVisited(a)}},redirectToLastPageVisited:function(){var a=b._getLocalStorageValue(b.getSecurityCrumbStorageKey()),e=window.ajaxSecKey,c=window.location.pathname,d=b._removeUnwantedQuerystringParams(window.location.href),
g=window.pageHeaderJsonData,f=b._getLocalStorageValue(b.getRedirectStorageKey());b._storeSecurityCrumb();if(!f||a===e||!b._isStartPage(c)&&b._isDeepLink(c)||d===f||g&&b._buildPageInfoData(g.pageInfo)===b._getLastPageVisitedPageInfo()&&b._isQuerystringMatch(window.location,f))return!1;window.location=f;return!0},ignoreLastPage:function(){var a=location.search,b=!1,c=window.pageHeaderJsonData;c&&c.utilityLinks&&(b=(b=c.utilityLinks.links)&&b.some(function(a){return"PROXY_BECOME_SELF"===a.id}));return-1!=
a.indexOf("saveLastPageSaved\x3dfalse")||-1!=a.indexOf("bplte_logout\x3d1")||0==location.pathname.indexOf("/sf/logout")||0==location.pathname.indexOf("/sf/protected")||b},setLastPageVisited:function(a){var e;if(b.ignoreLastPage()||b._isNoStoreUrl(window.location.search))b.clearLastPageVisited();else if(null!=b.getRedirectStorageKey()){if(a)e=a;else if(b._isDeepLink(window.location.pathname))e=window.location.href;else{b.clearLastPageVisited();return}if(a=b.getRedirectStorageKey())e=b._removeUnwantedQuerystringParams(e),
b._setLocalStorage(a,e);b._storeSecurityCrumb();b._storeLastPageVisitedPageInfo()}},setCurrentPageAsLastVisited:function(){b.setLastPageVisited(location.pathname+location.search+location.hash)},clearLastPageVisited:function(){try{for(var a=[],b=/_lastPageVisited$/,c=0;c<localStorage.length;c++){var d=localStorage.key(c);b.test(d)&&a.push(d)}a.forEach(function(a){localStorage.removeItem(a)})}catch(g){}},_storeLastPageVisitedPageInfo:function(){if(window.pageHeaderJsonData){var a=b._buildPageInfoData(pageHeaderJsonData.pageInfo);
b._setLocalStorage("lastPageVisitedPageInfoData",a)}},_storeSecurityCrumb:function(){b._setLocalStorage(b.getSecurityCrumbStorageKey(),window.ajaxSecKey)},_getLastPageVisitedPageInfo:function(){return b._getLocalStorageValue("lastPageVisitedPageInfoData")},_setLocalStorage:function(a,b){try{a&&window.localStorage&&localStorage.setItem(a,b)}catch(c){}},_getLocalStorageValue:function(a){try{if(a&&window.localStorage)return localStorage.getItem(a)}catch(e){}return null},setInitialLastPageVisited:function(a){b._initialLastPageVisited=
a},getInitialLastPageVisited:function(){return b._initialLastPageVisited},getSecurityCrumbStorageKey:function(){return"lastPageSecurityCrumb"},isSkipRedirect:function(){var a=!!document.getElementById("skipLastPageRedirect");a||(a=(a=window.pageHeaderJsonData)&&a.settings&&"true"==a.settings.skipLastPageRedirect);return a},getRedirectStorageKey:function(){var a,b,c=window.pageHeaderJsonData;c&&(b=(a=c.userInfo)&&a.id||"",a=c.companyId||"");!a&&(a=document.getElementById("companyInstanceId"))&&(a=
a.content);!b&&(b=document.getElementById("userId"))&&(b=b.content);return a&&b?[b,a,"lastPageVisited"].join("_"):null},_buildPageInfoData:function(a){var b="";a&&(a.moduleId&&(b+=a.moduleId),a.pageId&&(b+=":"+a.pageId),a.pageQualifier&&(b+=":"+a.pageQualifier));return b},_isNoStoreUrl:function(a){return a?-1!=a.indexOf("lastPageVisited\x3dnostore"):!1},_isQuerystringMatch:function(a,e){var c=document.createElement("a");c.href=e;var d=a.search,d=d?b._removeUnwantedQuerystringParams(d):"",g=a.hash||
"",f=c.search,f=f?b._removeUnwantedQuerystringParams(f):"",c=c.hash||"";return d===f&&g===c},_removeUnwantedQuerystringParams:function(a){return b._removeQuerystringParams(a,["_s.crb","side-panel"])},_removeQuerystringParams:function(a,b){var c="",d=a.indexOf("#");0<=d&&(c=a.substring(d),a=a.substring(0,d));b.forEach(function(b){a=a.replace(new RegExp("([?\x26])"+b+"\x3d[^\x26]*(?:\x26|$)"),"$1")});d=a.substring(a.length-1);a="\x26"==d||"?"==d?a.substring(0,a.length-1):a;return a+c},_isDeepLink:function(a){return/^\/sf\//i.test(a)},
_isStartPage:function(a){return/^\/sf\/start/i.test(a)}},l=0,k=!1;setTimeout(h,0)})();