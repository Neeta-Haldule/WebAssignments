function SFDatePicker(a,b){this.register();this.init(a,b)}SFDatePicker.VIEW_TYPE_LINK="link";SFDatePicker.FIELD_TYPE_DATE="DATE";SFDatePicker.FIELD_TYPE_CAL="calendar";SFDatePicker.SERVER_DATE_FORMAT="yyyy-MM-dd";SFDatePicker.DATE_FORMAT_EXAMPLE=MSGS.COMMON_DateFormatExample;
juic.extend(SFDatePicker,SFAbstractInputField,{dateformatter:new DateFormat(MSGS.COMMON_DateFormat),ISO8601Dateformatter:new DateFormat(SFDatePicker.SERVER_DATE_FORMAT),init:function(a,b){this.setValue(a);this._config=b=b||{};this._isModified=this.stopRecreate=this._ariaLabel=this._isRequired=!1;this._defaultToday=!1!==b.defaultToday;this._writable=!1!==b.writable;this._viewType=b.viewType;this._calendarView=new SFDatePickerView(this._value,b);this._calendarView.addEventListener("dateSelected",this);
this._calendarView.addEventListener("clickedOnCalendar",this);this._calendarView.addEventListener("calenderReDrawn",this);this._dateSelected=!1},isRequired:function(){return this._isRequired},setRequired:function(a){this._isRequired=!!a},setAriaLabel:function(a){this._ariaLabel=a},cleanup:function(){this._hideCalendar();this._calendarView.cleanup();this._sfError.cleanup();this.unregister()},_getFormattedValue:function(a){return a&&a.length?(a=this.dateformatter.parse(a))?this.ISO8601Dateformatter.format(a):
"INVALID":""},getValue:function(){this._writable&&(this._value=this._getElementValue());return this._getFormattedValue(this._value===SFDatePicker.DATE_FORMAT_EXAMPLE?"":this._value)},getValueLocalFormat:function(){if(this._writable){var a=this._getElementValue();return a===SFDatePicker.DATE_FORMAT_EXAMPLE?"":a}return this._value},isModified:function(){return this._isModified},setValue:function(a){if(a&&0!=a.trim().length){var b=this.ISO8601Dateformatter.parse(a.trim());this._value=b?this.dateformatter.format(b):
a}else this._value=this._defaultToday?this.dateformatter.format(new Date):SFDatePicker.DATE_FORMAT_EXAMPLE;this._tempOldValue=this._value||this._oldValue;this._oldValue||(this._oldValue=this._value);if(a=this._writable?juic.$(this.getReferenceId()):juic.$(this.id+"_read"))this._writable?this._setElementValue(this._value):a.innerHTML=this._value,this._hideCalendar()},reset:function(){this.setValue(this._oldValue);this._isModified=!1;this.setErrorMsg("");this._hideCalendar()},_isDateEmpty:function(a){return a===
SFDatePicker.DATE_FORMAT_EXAMPLE},_renderWriteHtml:function(a){a.push('\x3cinput class\x3d"formElement" autocomplete\x3d"off" type\x3d"text" id\x3d"',this.id,'_write" aria-haspopup\x3d"true" ');this._isRequired&&a.push(' aria-required\x3d"true" ');this._ariaLabel&&a.push(' aria-label\x3d"',MSGS.get("COMMON_INPUT_TITLE",this._ariaLabel),'" ');a.push('onchange\x3d"',this.fireCode("_change"),'" onkeypress\x3d"',this.fireCode("_keypress"),'" onclick\x3d"',this.fireCode("_click"),'" onfocus\x3d"',this.fireCode("_focus"),
'" onblur\x3d"',this.fireCode("_blur"),'" ');a.push('value\x3d"',juic.escapeHTML(this._value),'" size\x3d"12" title\x3d"',MSGS.get("COMMON_INPUT_TITLE",""),'" /\x3e')},renderHtml:function(a){this._writable&&(this._viewType===SFDatePicker.VIEW_TYPE_LINK?a.push('\x3ca class\x3d"link" id\x3d"',this.id,'" aria-haspopup\x3d"true" onblur\x3d"',this.fireCode("_hideOnBlur"),'" onclick\x3d"',this.fireCode("_focusLinkView"),'return false;" href\x3d"javascript:void(0);" \x3e',juic.escapeHTML(this._value),"\x3c/a\x3e"):
this._drawRoundedCorners(a,"textBox"));this._readOnlyClass+=this._writable?" readComp":" read_only";a.push('\x3cspan id\x3d"',this.id,'_read" class\x3d"',this._readOnlyClass,'"\x3e',this._isDateEmpty(this._value)?"":juic.escapeHTML(this._value),"\x3c/span\x3e");this._sfError.renderHtml(a)},_hideCalendar:function(){juic.$(this.getReferenceId())&&this._viewType!==SFDatePicker.VIEW_TYPE_LINK&&this._updateWrapperClassName();this.stopRecreate=!1;SFDOMEvent.removeListener(window.document,"touchend",this._hideCallbackFn,
this);SFDOMEvent.removeListener(window.document,"click",this._hideCallbackFn,this);SFDOMEvent.removeListener(window.document,"keydown",this._keyEvents,this);SFPositionManager.removeEventListener("positionFixed");clearInterval(this.moveInterval);this.moveInterval=null;this._calendarView.dispatch("hide");this._calendarView.assignAriaAttributes("true")},_hideOnBlur:function(){var a=this;this.hideTimeout=setTimeout(function(){a._hideCalendar()},300)},_blur:function(){this._hideOnBlur();this._setDefaultDate();
this.setFocus(!1)},_change:function(){this._isModified=this._oldValue!==this._getElementValue();this._hideCalendar();this.checkForErrors();if(!this._hasError){var a=this.isModified()?"fieldChange":"fieldUnChange";this.dispatch("change",{actionCommand:a,value:this.getValue(),oldValue:this._getFormattedValue(this._oldValue),tempOldValue:this._getFormattedValue(this._tempOldValue)})}},_click:function(){this._focus()},_keypress:function(a){var b=this,c=juic.$(this.getReferenceId());setTimeout(function(){c.value.trim().length&&
b._hideOnBlur()},100)},_showCalPopup:function(){SFPositionManager.addEventListener("positionFixed",this);SFPositionManager.show(this._calendarView,this.getReferenceId());this._calendarView.assignAriaAttributes("false");var a=this;clearInterval(this.moveInterval);this.moveInterval=null;this.moveInterval=setInterval(function(){SFPositionManager.moveTo(a._calendarView.id,null,a.id)},500);SFDOMEvent.addListener(window.document,"keydown",this._keyEvents,this)},_focusLinkView:function(a){SFDOMEvent.stopPropagation(a);
this.stopRecreate||this._showCalPopup()},_focus:function(a){this.dispatch("dateFocused",a);this._tempOldValue=this._getElementValue();this.stopRecreate||this._dateSelected||(this._calendarView.setValue(this._tempOldValue),this._clearDefaultDate(),this._showCalPopup());this.setFocus(!0);this.setErrorMsg();this._dateSelected=!1},_keyEvents:function(a){var b=SFDOMEvent.getCharCode(a);SFDOMEvent.getKeyName(a||window.event);switch(b){case 27:this._calendarView._monthMenu.isPopupShown()||this._calendarView._yearMenu.isPopupShown()||
(this.calendarViewInFocus&&this.setFocus(!0),this._hideCalendar(),this.calendarViewInFocus=!1,this.setFocus(!0));break;case 49:a.shiftKey&&a.ctrlKey&&(this.calendarViewInFocus=!0,this._calendarView.setFocus());break;case 37:case 39:this._calendarView.isNearByDatesCalendar&&(37===b?this._calendarView.gotoPreviousMonth():this._calendarView.gotoNextMonth(),this.calendarViewInFocus=!0,this._calendarView.setFocus())}},_setDefaultDate:function(){this._getElementValue()||this._setElementValue(SFDatePicker.DATE_FORMAT_EXAMPLE)},
_clearDefaultDate:function(a){this._getElementValue()===SFDatePicker.DATE_FORMAT_EXAMPLE?this._setElementValue(""):juic.$(this.getReferenceId()).select();a&&this._setElementValue(SFDatePicker.DATE_FORMAT_EXAMPLE)},_hideCallbackFn:function(){try{this._isClickOutsideOfCalendar(this._calendarView,document.activeElement)&&this._hideCalendar()}catch(a){}},_isMatchingOverlay:function(a){if(a=juic.$(a.positionInfo.overlay.overlayId)){a=a.childNodes;for(var b=0;b<a.length;b++)if(a[b].id===this._calendarView.id)return!0}return!1},
_isClickOutsideOfCalendar:function(a,b){return a&&b?!(SFDom.isAncestor(juic.$(a.getReferenceId()),b)||SFDom.isAncestor(juic.$(this._calendarView._monthMenu._menu._menu.id),b)||SFDom.isAncestor(juic.$(this._calendarView._yearMenu._menu._menu.id),b)):!0},handleEvent:function(a){switch(a.type){case "dateFocused":clearTimeout(this.hideTimeout);this.hideTimeout=null;this.stopRecreate=!0;this._focus();break;case "dateSelected":this._setElementValue(a.datevalue);this._change();this._dateSelected=!0;juic.$(this.getReferenceId()).focus();
this.stopRecreate=!0;this._hideCalendar();break;case "positionFixed":this._isMatchingOverlay(a)&&(this._positionInfo=a.positionInfo,this.dispatchEvent(a));break;case "clickedOnCalendar":var b=this;clearTimeout(this.hideTimeout);this.hideTimeout=null;SFDOMEvent.removeListener(window.document,"click",b._hideCallbackFn,b);setTimeout(function(){SFDOMEvent.addListener(window.document,"click",b._hideCallbackFn,b)},50);break;case "calenderReDrawn":SFDom.setFocus(this.getReferenceId(),!1),this.stopRecreate=
!0}},_setElementValue:function(a){var b=juic.$(this.getReferenceId());b&&(this._viewType===SFDatePicker.VIEW_TYPE_LINK?b.innerHTML=a:b.value=a)},_getElementValue:function(){var a=juic.$(this.getReferenceId());return a?this._viewType===SFDatePicker.VIEW_TYPE_LINK?a.innerHTML:a.value.trim():this._value},bindSpecificValidators:function(a){SFValidationMgr.bindValidator(this,"dateFormat",{message:sfMessageFormat.format(MSGS.COMMON_ERR_DATA_FORMAT,a.label,sfMessageFormat.format(MSGS.COMMON_ERR_DATA_EXPECTED,
SFDatePicker.DATE_FORMAT_EXAMPLE))})},getReferenceId:function(){return this._viewType===SFDatePicker.VIEW_TYPE_LINK?this.id:this.id+"_write"}});function SFDatePickerView(a,b){this.register();this.init(a,b)}
juic.extend(SFDatePickerView,juic.Component,{dateFormat:new DateFormat(MSGS.COMMON_DateFormat),mediumDateFormat:new DateFormat(MSGS.COMMON_MEDIUM_DateFormat),minDay:null,minMonth:null,minDate:null,minYear:1900,maxYear:2699,currentSelection:null,currentFocusedDate:null,currentDate:1,displayYear:0,displayMonth:0,yearValue:null,monthValue:null,hidePreviousAndNextMonthDaysFromView:!1,startingDayOfWeek:0,isNearByDatesCalendar:!1,displayWeekNumbers:!1,init:function(a,b){var c=b.dateFormatter;c&&(this.dateFormat=
new DateFormat(c));this.weekdays=window.dateFormatSymbols.weekdays;this.months=window.dateFormatSymbols.months;(c=b.startingDayOfWeek)||0===c||(c=window.firstDayOfWeek||0);this.startingDayOfWeek=c;this.hidePreviousAndNextMonthDaysFromView=b.hideOtherMonths||!1;this.isNearByDatesCalendar=b.nearByDates||!1;this.displayWeekNumbers=b.displayWeekNumbers||this._displayWeekNumber();this._focusLoopMarkers=new SFFocusLoop(this.id);void 0!=b.minDate&&-1!=b.minDate&&(c=b.minDate.split("-"),this.minDay=c[2],
this.minMonth=eval(c[1])-1,this.minYear=c[0],this.minDate=new Date(this.minYear,this.minMonth,this.minDay));this.setValue(a)},setValue:function(a){this.currentDate=(this.currentSelection=a&&this.dateFormat.parse(a)||new Date,this.currentSelection.getDate());this.currentFocusedDate=new Date(this.currentSelection);this.displayYear=this.currentSelection.getFullYear();this.displayMonth=this.currentSelection.getMonth()},_formatMonthAndYear:function(a,b){MSGS.COMMON_CALENDAR_MONTH_AND_YEAR||(MSGS.COMMON_CALENDAR_MONTH_AND_YEAR=
"{0} {1}");return MSGS.get("COMMON_CALENDAR_MONTH_AND_YEAR",juic.escapeHTML(a),juic.escapeHTML(b))},_redraw:function(a,b){var c=this.months[a];this.isNearByDatesCalendar?juic.$(this.id+"_header").innerHTML=this._formatMonthAndYear(c,b):(this._monthMenu.updateButtonText(c,MSGS.COMMON_Months),this._yearMenu.updateButtonText(b,MSGS.COMMON_Years));this.minMonth&&0<=this.minMonth&&b==this.minYear&&a<this.minMonth&&(a=this.minMonth);c=juic.createRenderContext();this._renderCalendar(c,b,a);juic.$(this.id).innerHTML=
c.join("")},_renderHeader:function(a,b,c,d){if(this.isNearByDatesCalendar){b=new SFTriangle({size:5,direction:"left",color:"#ffffff"});var e=new SFTriangle({size:5,direction:"right",color:"#ffffff"}),f="sfDatePickerViewHeader";b.addEventListener("triangleClickEvent",this,"gotoPreviousMonth");e.addEventListener("triangleClickEvent",this,"gotoNextMonth");this.displayWeekNumbers&&(f="sfDatePickerViewHeaderWithWeekNumbers");a.push(b);a.push('\x3cspan id\x3d"',this.id,'_header" onclick\x3d"',this.fireCode("_clickOnCalendar"),
'" class\x3d"',f,'"\x3e');a.push(this._formatMonthAndYear(this.months[c],d));a.push("\x3c/span\x3e");a.push(e)}else{e=this._formatMonthAndYear("_0M0_","_1Y1_");e=e.indexOf("_0M0_")<=e.indexOf("_1Y1_");a.push('\x3cspan id\x3d"',this.id,'_header"  onclick\x3d"',this.fireCode("_clickOnCalendar"),'"\x3e');for(f=0;2>f;f++)0==f&&e||1==f&&!e?this._renderMonth(a,b,c):this._renderYear(a,d);a.push("\x3c/span\x3e")}},_renderMonth:function(a,b,c){this._initMonth(b,c);this._monthMenu=new SFMenuDropDown(this._monthMenuModel,
{cssClassesAux:"SFDatePickerMenuLinkText",popupCss:"SFDatePickerMenuDropDown",hasOpacity:!0});a.push(this._monthMenu);this._monthMenu.addEventListener("action",this,"_handleMenuChange");this._monthMenu.addEventListener("preventBlur",this,"_clickOnCalendar");this._monthMenu.setFocusedItem(this._monthMenuModel.getSelectedIndex())},_renderYear:function(a,b){this._initYear(b);this._yearMenu=new SFMenuDropDown(this._yearMenuModel,{cssClassesAux:"SFDatePickerMenuLinkText",popupCss:"SFDatePickerMenuDropDown",
hasOpacity:!0});a.push(this._yearMenu);this._yearMenu.addEventListener("action",this,"_handleMenuChange");this._yearMenu.addEventListener("preventBlur",this,"_clickOnCalendar");this._yearMenu.setFocusedItem(this._yearMenuModel.getSelectedIndex())},_initMonth:function(a,b){for(var c=[],d,e=a;e<this.months.length;e++)d=juic.escapeHTML(this.months[e]),c.push({actionCommand:"monthClicked",title:d,label:d,value:e});this._monthMenuModel=new SFDefaultSingleSelectModel(c);this._monthMenuModel.setSelectedIndex(b-
a)},_initYear:function(a){for(var b=[],c=this.minYear;c<=this.maxYear;c++)b.push({actionCommand:"yearClicked",title:c,label:c,value:c});this._yearMenuModel=new SFDefaultSingleSelectModel(b);this._yearMenuModel.setSelectedIndex(a-this.minYear)},gotoPreviousMonth:function(a){this._clickOnCalendar();a=this.displayMonth;var b=this.displayYear;a=(--a+12)%12;b=a>this.displayMonth?--b:b;this._redraw(a,b)},gotoNextMonth:function(a){this._clickOnCalendar();a=this.displayMonth;var b=this.displayYear;a=++a%
12;b=a<this.displayMonth?++b:b;this._redraw(a,b)},_handleMenuChange:function(a){var b="month";switch(a.actionCommand){case "monthClicked":this.displayMonth=a.menuItem.value;break;case "yearClicked":this.displayYear=a.menuItem.value,b="year"}this.currentFocusedDate=new Date(this.displayYear,this.displayMonth,1);this._redraw(this.displayMonth,this.displayYear);this.setFocus();"month"===b?this._monthMenu.focus():this._yearMenu.focus()},_renderDayNames:function(a){var b=this.startingDayOfWeek||0,c=7,
d=MSGS.COMMON_singleCharWeekdays.split(",");for(this.displayWeekNumbers&&a.push('\x3cth scope\x3d"col"\x3e\x26nbsp;\x3c/th\x3e');c--;)a.push('\x3cth scope\x3d"col" title\x3d"',this.weekdays[b],'" role\x3d"columnheader"\x3e',d[b],"\x3c/th\x3e"),b=++b%7},_renderCalendar:function(a,b,c,d){var e=this._focusLoopMarkers.getMarkers();d||(d=1);d=new Date(b,c,d);this.displayYear=d.getFullYear();this.displayMonth=d.getMonth();a.push(e[0]);a.push('\x3cdiv class\x3d"header" UNSELECTABLE\x3d"on"\x3e');var f=0;
this.minMonth&&0<=this.minMonth&&this.displayYear==this.minYear&&(f=this.minMonth);this._renderHeader(a,f,this.displayMonth,this.displayYear);a.push('\x3c/div\x3e\x3ctable summary\x3d"',MSGS.get("COMMON_CALENDAR",juic.escapeHTML(this.months[this.displayMonth]),juic.escapeHTML(this.displayYear)),'" class\x3d"',this.displayWeekNumbers?"showWeekNumbers":"",'" id\x3d"dates" role\x3d"presentation"\x3e\x3cthead\x3e\x3ctr\x3e');this._renderDayNames(a);a.push("\x3c/tr\x3e\x3c/thead\x3e");d=(this.startingDayOfWeek-
d.getDay()-7)%7;d=new Date(this.displayYear,this.displayMonth,1+d);for(a.push("\x3ctbody\x3e");d.getFullYear()<this.displayYear||d.getFullYear()==this.displayYear&&d.getMonth()<=c;){a.push("\x3ctr\x3e");this.displayWeekNumbers&&(f=this._getWeekNumber((d.getMonth()+1)%12==c?new Date(b,c,1):d),a.push('\x3ctd title\x3d"',MSGS.get("COMMON_CALENDAR_WEEK_NUM",f),'" class\x3d"weekNumber" aria-selected\x3d"false" unselectable\x3d"on"\x3e\x3cspan class\x3d"weekNumSpan"\x3e'),a.push(f,"\x3c/span\x3e\x3c/td\x3e"));
for(f=0;7>f;++f){var g=d.getDate(),h=juic.escapeHTML(this.dateFormat.format(d)),l=this.hidePreviousAndNextMonthDaysFromView?" hidden ":"",m=this._isDayAWeekend(d)?" weekend ":"",n=this._isDayToday(d)?" today":"",k=!1;this.minDate&&-1!=this.minDate&&d.getTime()<this.minDate.getTime()?(a.push('\x3ctd title\x3d"'+h+'" class\x3d"minMaxDate ',m,n,'" aria-selected\x3d"false"\x3e'),a.push(g,"\x3c/td\x3e")):(a.push("\x3ctd title\x3d'"+h+"'"),a.push(' class\x3d"',m,n),0===f&&a.push(" firstDayOfWeek"),6===
f&&a.push(" lastDayOfWeek"),this._isSelectedDate(d)?(a.push(" selected ",'" aria-selected\x3d"true"'),a.push(' id\x3d"',this.id,'_selectedDate"')):(d.getMonth()+1)%12==c?(a.push(" previous",l,'" aria-selected\x3d"false"'),k=!0):d.getMonth()!=c?(k=!0,a.push(" next",l,'" aria-selected\x3d"false"')):a.push(" ",'" aria-selected\x3d"false"'),a.push(' UNSELECTABLE\x3d"on"\x3e'),k&&this.hidePreviousAndNextMonthDaysFromView||(a.push('\x3ca id\x3d"',this._generateDateId(d),'" aria-label\x3d"',juic.escapeHTML(this.mediumDateFormat.format(d)),
'" tabindex\x3d"'),this._isSelectedDate(d)&&d.getMonth()==c||1==d.getDate()&&!this._isSelectedMonth(d)&&d.getMonth()==c?a.push(0):a.push(-1),a.push('" href\x3d"javascript:void(0);" onkeydown\x3d"',this.fireCode("_arrowKeyClicked"),'" return false; onclick\x3d"',this.fireCode("_dateSelected",h),'return false;"\x3e ',g," \x3c/a\x3e\x3c/td\x3e")));d.setDate(g+1)}a.push("\x3c/tr\x3e")}a.push("\x3c/tbody\x3e\x3c/table\x3e");a.push(e[1]);this.dispatch("calenderReDrawn")},_displayWeekNumber:function(){return!1},
_getWeekNumber:function(a){var b=new Date(a.getFullYear(),0,1);return Math.ceil(((a-b)/864E5+(b.getDay()+1))/7)},_isDayAWeekend:function(a){a=a.getDay();return 0===a||6===a},_clickOnCalendar:function(){this.dispatch("clickedOnCalendar")},_arrowKeyClicked:function(a){var b=SFDOMEvent.getCharCode(a);if(37<=b&&40>=b){var c;switch(b){case 39:c=1;break;case 37:c=-1;break;case 38:c=-7;break;case 40:c=7}b=new Date(this.currentFocusedDate);b.setDate(b.getDate()+c);var d=b.getMonth()==this.displayMonth,e=
this._getCurrentFocusedDateEl();d?e.setAttribute("tabindex",-1):this._redraw(b.getMonth(),b.getFullYear());this.currentFocusedDate.setDate(this.currentFocusedDate.getDate()+c);e=this._getCurrentFocusedDateEl();e.setAttribute("tabindex",0);e.focus();d||this._clickOnCalendar();SFDOMEvent.stopEvent(a)}},_generateDateId:function(a){return this.id+a.getFullYear()+a.getMonth()+a.getDate()},_getCurrentFocusedDateEl:function(){return juic.$(this._generateDateId(this.currentFocusedDate))},_dateSelected:function(a){this.dispatch("dateSelected",
{datevalue:a})},_toDayDate:function(){this._dateSelected(this.dateFormat.format(new Date))},renderHtml:function(a){a.push('\x3cdiv id\x3d"',this.id,'" class\x3d"globalModernStyleSupport sfDatePicker globalBoxShadowSmall" aria-label\x3d"',MSGS.COMMON_CALENDAR_DIALOG,'" aria-hidden\x3d"true" role\x3d"dialog"\x3e');this._renderCalendar(a,this.displayYear,this.displayMonth);a.push("\x3c/div\x3e")},_isSelectedDate:function(a){var b=this.currentSelection;return b&&b.getDate()==a.getDate()&&b.getMonth()==
a.getMonth()&&b.getFullYear()==a.getFullYear()},_isSelectedMonth:function(a){var b=this.currentSelection;return b&&b.getMonth()==a.getMonth()&&b.getFullYear()==a.getFullYear()},_isDayToday:function(a){var b=new Date;return b.getDate()==a.getDate()&&b.getMonth()==a.getMonth()&&b.getFullYear()==a.getFullYear()},assignAriaAttributes:function(a){var b=juic.$(this.id);b&&b.setAttribute("aria-hidden",a)},handleEvent:function(a){},setFocus:function(){this._focusLoopMarkers.setFocus(!1);var a=this;setTimeout(function(){a._clickOnCalendar()},
1)}});