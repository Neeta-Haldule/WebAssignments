"undefined"==typeof window.PMWizardUtil&&(window.PMWizardUtil=function(){return juic.set({},{showGetFeedback:function(){"undefined"==typeof this.getFeedbackWizard&&(this.getFeedbackWizard=new PMWizard({currentUserId:formConfig?formConfig.currentUser?formConfig.currentUser.userId:void 0:void 0,currentUserFullName:formConfig?formConfig.currentUser.formattedFullName:"",formDataId:formConfig?formConfig.formDataId:void 0,folderMapId:formConfig?formConfig.folderMapId:void 0,hasRadioOptions:formConfig?2==
formConfig.getFeedback.feedbackOpt.options.length:!1,optionValue:formConfig?formConfig.getFeedback.feedbackOpt.options[0].value:"",optionValueComments:"comments",optionValueEdits:"edits",sendAction:"act_send",sendAndOpenNextAction:"act_send_and_open_next",paramSendAction:"fb2wk_form_send_act",paramUserId:"fb2wk_form_p_user",paramComment:"fb2wk_form_p_comment",paramOption:"fb2wk_form_feedbackopt"},{singleSelection:!0,allowDuplicatedUsers:!1,title:formData?formData.GetFeedback?formData.GetFeedback.label:
MSGS.ROUTE_Get_Feedback:MSGS.ROUTE_Get_Feedback,isAdvancedFilterOptions:!0}));this.getFeedbackWizard.show()},showAddModifier:function(){"undefined"==typeof this.addModifierWizard&&(this.addModifierWizard=new PMWizard({currentUserId:formConfig?formConfig.currentUser?formConfig.currentUser.userId:void 0:void 0,existParams:"xsc_fields bplte_p_scrollpos bplte_handleto bplte_company bplte_orapool bplte_userid bplte_username fbacme_o cal_subject_key cal_starttime_key cal_foldermap_id_key bplte_previewurl pp_cal_session_id pp_pm_owner fb2toolbar_scan_option_val reqOrig page_no myf_os myf_ns myf_ss myf_mode inbox_fbfl_ftype inbox_os inbox_fmid inbox_did fbacme_pCFs fb2rte_is_fb_routing_bar".split(" "),
params:[{key:"fb2wk_form_p_state",value:"add_modifier"},{key:"fbaddmod_state",value:"view_list"},{key:"fbaddmod_btn_save",value:MSGS.BTN_Save_Changes}],paramAddedUsers:"fbaddmod_hide_user",userIdSpliter:"~~"},{singleSelection:!1,allowDuplicatedUsers:!1,title:MSGS.ROUTE_ADDEVALUATOR2,isAdvancedFilterOptions:!1}));this.addModifierWizard.show()},showAddSigner:function(){"undefined"==typeof this.addSignerWizard&&(this.addSignerWizard=new PMWizard({currentUserId:formConfig?formConfig.currentUser?formConfig.currentUser.userId:
void 0:void 0,existParams:"xsc_fields bplte_p_scrollpos bplte_handleto bplte_company bplte_orapool bplte_userid bplte_username fbacme_o cal_subject_key cal_starttime_key cal_foldermap_id_key bplte_previewurl pp_cal_session_id pp_pm_owner fb2toolbar_scan_option_val reqOrig page_no myf_os myf_ns myf_ss myf_mode inbox_fbfl_ftype inbox_os inbox_fmid inbox_did fbacme_pCFs fb2rte_is_fb_routing_bar".split(" "),params:[{key:"fb2wk_form_p_state",value:"add_signer2"},{key:"fbas2_add",value:MSGS.Save_Changes_and_Return_to_Form}],
paramAddedUsers:"fbas2_added_signers",userIdSpliter:'","',jsonFormatUserIds:!0},{singleSelection:!1,allowDuplicatedUsers:!0,title:MSGS.ROUTE_ADDSIGNER,isAdvancedFilterOptions:!1}));this.addSignerWizard.show()},showRemoveSigner:function(){if("undefined"==typeof this.removeSignerDialog){var a=formConfig?formConfig.formDataId:void 0,b=formConfig?formConfig.currentUser?formConfig.currentUser.userId:void 0:void 0,c=window.revApp&&window.revApp.getCurrentStep()||"";this.removeSignerDialog=new PMRemoveSigner({formDataId:a,
currentUserId:b,currentStepId:c},{title:MSGS.PERFORMANCE_ROUTE_REMOVE_SIGNER})}this.removeSignerDialog.show()},showRecallFeedback:function(){"undefined"==typeof this.recallFeedback&&(this.recallFeedback=new PMRecallFeedback({key:formConfig?formConfig.getFeedback.recallForm.submitparams.key:"",value:formConfig?formConfig.getFeedback.recallForm.submitparams.value:""},formConfig?formConfig.getFeedback.recallForm.currentlyWith:""));this.recallFeedback.show()}})}());
function PMWizard(a,b){this.register();this.init(a,b)}
juic.extend(PMWizard,Component,{init:function(a,b){this._data=a;this._singleSelection=b?!!b.singleSelection:!1;this._allowDuplicatedUsers=b?!!b.allowDuplicatedUsers:!1;this._title=b?b.title:"";this._isAdvancedFilterOptions=b?!!b.isAdvancedFilterOptions:!1;this._loadingPlaceholderId=this.id+"_loadingPlaceholder";this._searchStepId="search-tab";this._selectStepId="select-tab";this._confirmStepId="confirm-tab";this._tabWizard=new SFWizardTabs(this._getWizardData(),this._searchStepId);this._searchStep=
new PMSearchStep(this._data.currentUserId);this._searchStep.addEventListener("action",this);this._selectStep=new PMSelectStep(this._singleSelection);this._confirmStep=new PMConfirmStep(this._singleSelection,this._data);this._confirmStep.addEventListener("selectedUserStatus",this);this._dao=new PMGetFeedbackWizardDAO;this._dao.addEventListener("getFeedbackSearchStepReady",this,"_onSearchStepReady");this._dao.addEventListener("getUserListReady",this,"_onGetUserListReady");this._dao.addEventListener("getConfirmDetailsReady",
this,"_onGetConfirmDetailsReady");this._initButtons()},_initButtons:function(){this._cancelBtn=new SFCommandButton(MSGS.COMMON_Cancel,!1,!0,!0,{baseButtonWrapperClass:"sfDialogBoxButtonWrapper"});this._backBtn=new SFCommandButton(MSGS.COMMON_Back,!1,!0,!0,{baseButtonWrapperClass:"sfDialogBoxButtonWrapper"});this._searchBtn=new SFCommandButton(MSGS.COMMON_Search,!0,!1,!0,{baseButtonWrapperClass:"sfDialogBoxButtonWrapper"});this._selectBtn=new SFCommandButton(MSGS.COMMON_Select,!0,!0,!0,{baseButtonWrapperClass:"sfDialogBoxButtonWrapper"});
this._addMoreBtn=new SFCommandButton(MSGS.AddMore,!0,!0,!0,{baseButtonWrapperClass:"sfDialogBoxButtonWrapper"});this._saveChangesBtn=new SFCommandButton(MSGS.BTN_Save_Changes,!0,!0,!0,{baseButtonWrapperClass:"sfDialogBoxButtonWrapper"});this._sendBtn=new SFCommandButton(MSGS.COMMON_Send,!0,!0,!0,{baseButtonWrapperClass:"sfDialogBoxButtonWrapper"});this._sendAndOpenNextBtn=new SFCommandButton(MSGS.PERFORMANCE_SEND_OPEN_NEXT_FORM,!0,!0,!0,{baseButtonWrapperClass:"sfDialogBoxButtonWrapper"});this._cancelBtn.setActionCommand("closeDialog");
this._cancelBtn.addEventListener("action",this);this._backBtn.setActionCommand("back");this._backBtn.addEventListener("action",this);this._searchBtn.setActionCommand("search");this._searchBtn.addEventListener("action",this);this._selectBtn.setActionCommand("select");this._selectBtn.addEventListener("action",this);this._addMoreBtn.setActionCommand("addMore");this._addMoreBtn.addEventListener("action",this);this._saveChangesBtn.setActionCommand("saveChanges");this._saveChangesBtn.addEventListener("action",
this);this._sendBtn.setActionCommand("send");this._sendBtn.addEventListener("action",this);this._sendAndOpenNextBtn.setActionCommand("sendAndOpenNext");this._sendAndOpenNextBtn.addEventListener("action",this);this._hideShowButtons(this._searchStepId)},_hideShowButtons:function(a){this._cancelBtn.setVisible(!0);this._backBtn.setVisible(a==this._selectStepId||a==this._confirmStepId&&this._singleSelection);this._searchBtn.setVisible(a==this._searchStepId);this._selectBtn.setVisible(a==this._selectStepId);
this._addMoreBtn.setVisible(a==this._confirmStepId&&!this._singleSelection);this._saveChangesBtn.setVisible(a==this._confirmStepId&&!this._singleSelection);this._sendBtn.setVisible(a==this._confirmStepId&&this._singleSelection);this._sendAndOpenNextBtn.setVisible(a==this._confirmStepId&&this._singleSelection)},_hideShowSteps:function(a){this._searchStep.toggle(a==this._searchStepId);this._selectStep.toggle(a==this._selectStepId);this._confirmStep.toggle(a==this._confirmStepId)},_switchTab:function(a){this._tabWizard.selectTab(a);
this._hideShowSteps(a);this._hideShowButtons(a);this._cancelBtn.setFocus()},_getWizardData:function(){var a=[];a.push({tabId:this._searchStepId,label:MSGS.COMMON_Search});a.push({tabId:this._selectStepId,label:MSGS.COMMON_Select});a.push({tabId:this._confirmStepId,label:MSGS.COMMON_Confirm});return a},show:function(){if(window.PMUSaveUtils){var a=this;PMUSaveUtils.autoSaveForm(!0,!0,function(){a._show.call(a)})}},_initData:function(){this._dao.getSearchPageOptions(this._isAdvancedFilterOptions)},
_onSearchStepReady:function(a){this._searchStep.setData(a.data);this._searchBtn.setEnabled(!0);Util.hide(this._loadingPlaceholderId);this._switchTab(this._searchStepId)},_onGetUserListReady:function(a){this._searchBtn.setEnabled(!0);this._searchStep.showLoading(!1);this._searchByUserId?(this._confirmStep.setData(a.data),this._switchTab(this._confirmStepId)):(this._selectStep.setData(a.data,this._getSelectedUserIds()),this._selectBtn.setEnabled(this._selectStep.hasUsers()),this._switchTab(this._selectStepId))},
_onGetConfirmDetailsReady:function(a){this._getCurrentTabId()==this._searchStepId?(this._searchStep.toggleSelectBtn(!0),this._searchStep.showLoading(!1),this._submitParams=a.data.parameters,this._confirmStep.setData({backToStepId:this._searchStepId,commentShown:a.data.commentShown,user:this._searchStep.getSelectedUser()}),this._switchTab(this._confirmStepId)):this._getCurrentTabId()==this._selectStepId&&(this._selectBtn.setEnabled(!0),this._selectStep.showLoading(!1),this._submitParams=a.data.parameters,
this._confirmStep.setData({backToStepId:this._selectStepId,commentShown:a.data.commentShown,user:this._selectStep.getSelectedUsers()[0]}),this._switchTab(this._confirmStepId))},_show:function(){this._wizardDialog=new SFDialogBox({title:this._title,buttons:[],content:this,width:920,showCloseIcon:!1});this._wizardDialog.showDialog(!0,document.activeElement);this._initData()},_doSearch:function(){this._searchBtn.setEnabled(!1);this._searchStep.showLoading(!0);this._searchByUserId=!1;var a=this._searchStep.getSearchParam();
this._dao.searchUsers(a,this._isAdvancedFilterOptions)},_doSelect:function(){if(this._singleSelection){this._selectBtn.setEnabled(!1);this._selectStep.showLoading(!0);var a=this._selectStep.getSelectedUsers()[0];this._dao.getConfirmPageDetails(this._data.formDataId,this._data.folderMapId,a.attributes.USERID)}else this._confirmStep.setData({headers:this._selectStep.getHeaders(),users:this._selectStep.getSelectedUsers()}),this._switchTab(this._confirmStepId)},_doBack:function(){if(this._singleSelection){var a=
this._getCurrentTabId();a==this._selectStepId?this._switchTab(this._searchStepId):a==this._confirmStepId&&this._switchTab(this._confirmStep.getBackToStepId())}else this._switchTab(this._searchStepId)},_doAddMore:function(){this._searchStep.setSelectedUserIds(this._getSelectedUserIds());this._switchTab(this._searchStepId)},_doSelectUser:function(a){this._singleSelection?(this._searchStep.showLoading(!0),this._dao.getConfirmPageDetails(this._data.formDataId,this._data.folderMapId,a.attributes.USERID)):
(this._searchStep.showLoading(!0),this._searchByUserId=!0,this._dao.searchUsers({userId:a.attributes.USERID},this._isAdvancedFilterOptions))},_getSelectedUserIds:function(){return this._allowDuplicatedUsers?[]:this._confirmStep.getSelectedUserIds()},_getCurrentTabId:function(){return this._tabWizard.getTabId()},renderHtml:function(a){a.push("\x3cdiv id\x3d'pmTabWizard'\x3e");this._tabWizard.renderHtml(a);a.push("\x3c/div\x3e");a.push('\x3cdiv id\x3d"',this._loadingPlaceholderId,'" class\x3d"pmWizardContent"\x3e\x3cdiv class\x3d"loading"\x3e\x3c/div\x3e\x3c/div\x3e');
this._searchStep.renderHtml(a);this._selectStep.renderHtml(a);this._confirmStep.renderHtml(a);a.push('\x3cdiv class\x3d"pmWizardButtons"\x3e');this._cancelBtn.renderHtml(a);this._backBtn.renderHtml(a);this._selectBtn.renderHtml(a);this._searchBtn.renderHtml(a);this._addMoreBtn.renderHtml(a);this._saveChangesBtn.renderHtml(a);this._sendBtn.renderHtml(a);this._sendAndOpenNextBtn.renderHtml(a);a.push("\x3c/div\x3e")},handleEvent:function(a){if("action"==a.type)switch(a.actionCommand){case "closeDialog":this._wizardDialog&&
this._wizardDialog.close();this._searchStep.reset();this._selectStep.reset();this._confirmStep.reset();break;case "search":this._doSearch();break;case "select":this._doSelect();break;case "saveChanges":this._saveChangesBtn.setEnabled(!1);this._submitForm();break;case "back":this._doBack();break;case "addMore":this._doAddMore();break;case "selectUser":this._doSelectUser(a.user);break;case "send":this._saveChangesBtn.setEnabled(!1);this._submitForm(this._data.sendAction);break;case "sendAndOpenNext":this._saveChangesBtn.setEnabled(!1),
this._submitForm(this._data.sendAndOpenNextAction)}else"selectedUserStatus"==a.type&&(this._saveChangesBtn.setEnabled(!a.noUser),a.noUser&&this._addMoreBtn.setFocus())},_submitForm:function(a){var b=document.createElement("div");b.setAttribute("style","position:absolute;top:-10000px;left:0px");document.body.appendChild(b);var c=document.createElement("form");c.method=document.forms[0].method;c.action=document.forms[0].action;b.appendChild(c);a?(this._buildParameters(c,this._submitParams),this._buildParameters(c,
this._confirmStep.getSubmitParams()),this._buildInputField(c,this._data.paramSendAction,a)):(this._buildExistParameters(c,this._data.existParams),this._buildParameters(c,this._data.params),a=this._confirmStep.getSelectedUserIds().join(this._data.userIdSpliter),this._data.jsonFormatUserIds&&(a='["'+a+'"]'),this._buildInputField(c,this._data.paramAddedUsers,a));c.submit()},_buildParameters:function(a,b){if(b)for(var c=0,d=b.length;c<d;c++){var f=b[c];this._buildInputField(a,f.key,f.value)}},_buildExistParameters:function(a,
b){if(b)for(var c=0,d=b.length;c<d;c++){var f=b[c],e=document.getElementsByName(f);e&&0<e.length&&this._buildInputField(a,f,e[0].value)}},_buildInputField:function(a,b,c){var d=document.createElement("input");d.name=b;d.value=c;a.appendChild(d)}});function PMSearchStep(a){this.register();this.init(a)}
juic.extend(PMSearchStep,Component,{init:function(a){this._currentUserId=a;this._selectedUserIds=[];this._loadingPlaceholderId=this.id+"_loadingPlaceholder";this._filters=[];this._selectBtn=new SFCommandButton(MSGS.COMMON_Select,!1,!1,!0,{baseButtonWrapperClass:"sfDialogBoxButtonWrapper"});this._selectBtn.setActionCommand("selectUser");this._selectBtn.addEventListener("action",this);this._createPeopleNav()},_createPeopleNav:function(){this._peopleNav&&this._peopleNav.removeEventListener("personSelected",
this);this._peopleNav=new SFPersonAutoCompleteWrapper([{version:2,arguments:{additionalCriteria:{},forceSelection:!0,fixedWidth:"161px"}},{version:3,arguments:[null,{forceSelection:!0,enableExternalSearch:!1,enabled:!0,hideQuickcardDisplay:!0,fixedWidth:"200",isV12Plus:!0}]}],{useVersion3:!0});this._peopleNav.addEventListener("action",this)},handleEvent:function(a){"action"==a.type&&("selectUser"==a.actionCommand?(this.toggleSelectBtn(!1),this.dispatch("action",{actionCommand:"selectUser",user:this._selectedUser})):
"itemSelect"==a.actionCommand&&(this._selectedUser={formattedFullName:a.actionData.userDisplayValue,attributes:{USERID:a.actionData.userId}},this.toggleSelectBtn(!this._isUserSelected(a.userId))))},setData:function(a){this._searchData=a;this._prepare();a=juic.createRenderContext();this.renderDefaultFilter(a);this.renderCustomerFilter(a);$(this.id+"searchTab").innerHTML=a.join("")},setSelectedUserIds:function(a){this._selectedUserIds=a;a=this._selectedUser?!this._isUserSelected(this._selectedUser.attributes.USERID):
!1;this.toggleSelectBtn(a)},_isUserSelected:function(a){for(var b=0,c=this._selectedUserIds.length;b<c;b++)if(this._selectedUserIds[b]==a)return!0;return!1},toggleSelectBtn:function(a){this._selectBtn.setEnabled(a);this._selectBtn.setActive(a)},_getFilters:function(a){for(var b=[],c=0,d=a.length;c<d;c++){var f=a[c],e=new SFComboBox(f.options[0],f.options,{fixedWidth:!0});b.push(e);this._filters.push({name:f.name,juicObj:e})}return b},_prepare:function(){this.juicDefaultFilters=this._getFilters(this._searchData.defaultFilters);
this.juicCustomerFilters=this._getFilters(this._searchData.customFilters)},getSelectedUser:function(){return this._selectedUser},getSearchParam:function(){for(var a={},b=0,c=this._filters.length;b<c;b++){var d=this._filters[b],f=d.juicObj.getValueObject().id;""!=f&&(a[d.name]=f)}return a},toggle:function(a){a?Util.show(this.id,!0):Util.hide(this.id)},renderDefaultFilter:function(a){a.push('\x3cdiv class\x3d"searchBlock"\x3e');a.push('\x3cdiv class\x3d"searchTitleLeft"\x3e',MSGS.PERFORMANCE_GET_FEEDBACK_SEARCH_BY_FILTERING,
"\x3c/div\x3e");a.push('\x3cspan class\x3d"searchLabel"\x3e',MSGS.COMMON_Find,"\x3c/span\x3e");a.push('\x3cdiv class\x3d"floatLeft"\x3e');for(var b=0,c=this.juicDefaultFilters.length;b<c;b++)a.push("\x3cdiv\x3e"),this.juicDefaultFilters[b].renderHtml(a),a.push("\x3c/div\x3e");a.push("\x3c/div\x3e");a.push("\x3c/div\x3e");a.push('\x3cdiv class\x3d"searchBlock"\x3e');a.push('\x3cdiv class\x3d"searchTitle"\x3e',MSGS.RECRUITING_CANDIDATE_SEARCH_QUICK_FIND_HEADER,"\x3c/div\x3e");a.push('\x3cdiv class\x3d"floatLeft"\x3e');
this._selectedUser&&(this._createPeopleNav(),this.toggleSelectBtn(!1));this._peopleNav.renderHtml(a);a.push("\x3c/div\x3e");a.push('\x3cdiv class\x3d"floatLeft"\x3e');this._selectBtn.renderHtml(a);a.push("\x3c/div\x3e");a.push("\x3c/div\x3e");a.push('\x3cdiv style\x3d"clear:both"\x3e\x3c/div\x3e')},renderCustomerFilter:function(a){if(0!=this.juicCustomerFilters.length){a.push('\x3cdiv class\x3d"searchBlock"\x3e');a.push('\x3cspan class\x3d"searchLabel"\x3e',MSGS.PERFORMANCE_GET_FEEDBACK_SEARCH_BY_FILTERING,
"\x3c/span\x3e");a.push('\x3cdiv class\x3d"floatLeft"\x3e');for(var b=0,c=this.juicCustomerFilters.length;b<c;b++)a.push("\x3cdiv\x3e"),this.juicCustomerFilters[b].renderHtml(a),a.push("\x3c/div\x3e");a.push("\x3c/div\x3e");a.push("\x3c/div\x3e");a.push('\x3cdiv style\x3d"clear:both"\x3e\x3c/div\x3e')}},renderHtml:function(a){a.push('\x3cdiv id\x3d"',this.id,'" class\x3d"pmWizardContent" style\x3d"display:none;"\x3e');a.push('\x3cdiv id\x3d"',this._loadingPlaceholderId,'" class\x3d"loadingWrap" style\x3d"display:none;"\x3e\x3cdiv class\x3d"loading"\x3e\x3c/div\x3e\x3c/div\x3e');
a.push('\x3cdiv class\x3d"searchTab" id\x3d"',this.id+"searchTab",'"\x3e');a.push("\x3c/div\x3e");a.push("\x3c/div\x3e")},showLoading:function(a){a?Util.show(this._loadingPlaceholderId,!0):Util.hide(this._loadingPlaceholderId)},reset:function(){this.setSelectedUserIds([])}});function PMSelectStep(a){this.register();this.init(a)}
juic.extend(PMSelectStep,Component,{init:function(a){this._singleSelection=a;this._radioButtonName="radioButtonName_"+this.id;this._loadingPlaceholderId=this.id+"_loadingPlaceholder";this._userComps=[]},setData:function(a,b){this._usersData=a;this._userComps=[];this._selectedUserIds=b?b:[];this._isMoreThanMaxData=a.moreThanMaxData;this._tableData=a.users;this._updateWarningMsg();this._prepareHeader();this._renderUserList();this.selectedUser=null},_prepareHeader:function(){this._tableHeader=[];var a=
this._usersData.headers,b;for(b in a)a.hasOwnProperty(b)&&this._tableHeader.push({key:b,label:a[b]})},getHeaders:function(){return this._usersData.headers},getSelectedUsers:function(){for(var a=[],b=0,c=this._userComps.length;b<c;b++){var d=this._userComps[b];if(this._singleSelection){if(d.comp.getChecked()){a.push(d.data);break}}else d.comp.isChecked()&&d.comp.isEnabled()&&a.push(d.data)}return a},hasUsers:function(){return this._tableData&&0<this._tableData.length},toggle:function(a){a?Util.show(this.id,
!0):Util.hide(this.id)},_buildTableHeader:function(a){a.push("\x3cthead\x3e\x3ctr\x3e");for(var b=0,c=this._tableHeader.length;b<c;b++)a.push("\x3cth\x3e"),a.push(this._tableHeader[b].label),a.push("\x3c/th\x3e");a.push("\x3c/tr\x3e\x3c/thead\x3e")},_buildTableRows:function(a){a.push("\x3ctbody\x3e");for(var b=0,c=this._tableData.length;b<c;b++){var d=this._tableData[b].attributes.USERID;this._singleSelection?(a.push("\x3ctr\x3e"),this._buildTableRow(a,this._tableData[b],0==b)):(d=this._isUserSelected(d),
a.push("\x3ctr",d?' class\x3d"readonly"':"","\x3e"),this._buildTableRow(a,this._tableData[b],d));a.push("\x3c/tr\x3e")}a.push("\x3c/tbody\x3e")},_buildTableRow:function(a,b,c){for(var d=0,f=this._tableHeader.length;d<f;d++){a.push("\x3ctd\x3e");if(0==d)if(this._singleSelection){var e=new SFRadioButton(this._radioButtonName,b.attributes.USERID,c,!0);this._userComps.push({comp:e,data:b});e.renderHtml(a);a.push('\x3clabel for\x3d"',e.id,'"\x3e',b.formattedFullName,"\x3c/label\x3e")}else e=new SFCheckBox(c,
b.attributes.USERID,b.formattedFullName),e.setEnabled(!c),this._userComps.push({comp:e,data:b}),e.renderHtml(a);else e=(e=b.attributes[this._tableHeader[d].key])?e:"",a.push(e);a.push("\x3c/td\x3e")}},_isUserSelected:function(a){for(var b=0,c=this._selectedUserIds.length;b<c;b++)if(this._selectedUserIds[b]==a)return!0;return!1},_updateWarningMsg:function(){var a="";0==this._tableData.length?a=MSGS.PERFORMANCE_360_FINDUSERS_SEARCH_RETURN_NULL:this._isMoreThanMaxData&&(a=MSGS.FB_PERM_MATRIX_RPT_SEARCH_LIMIT_REACHED);
var b=$(this.id+"msg");(b.innerHTML=a)?Util.show(b,!0):Util.hide(b)},_renderUserList:function(){var a=juic.createRenderContext();a.push('\x3ctable class\x3d"usersTable" id\x3d"',this.id+"selectTable",'"\x3e');this._buildTableHeader(a);this._buildTableRows(a);a.push("\x3c/table\x3e");$(this.id+"selectTable").innerHTML=a.join("")},renderHtml:function(a){a.push('\x3cdiv id\x3d"',this.id,'" class\x3d"pmWizardContent" style\x3d"display:none;"\x3e');a.push('\x3cdiv id\x3d"',this._loadingPlaceholderId,'" class\x3d"loadingWrap" style\x3d"display:none;"\x3e\x3cdiv class\x3d"loading"\x3e\x3c/div\x3e\x3c/div\x3e');
a.push('\x3cdiv class\x3d"contentWrap"\x3e');a.push('\x3cdiv id\x3d"',this.id+"msg",'" class\x3d"searchResultMsg" style\x3d"display:none;"\x3e\x3c/div\x3e');a.push('\x3cdiv id\x3d"',this.id+"selectTable",'"\x3e');a.push("\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e")},showLoading:function(a){a?Util.show(this._loadingPlaceholderId,!0):Util.hide(this._loadingPlaceholderId)},reset:function(){this._usersData=void 0;this._userComps=[]}});function PMConfirmStep(a,b){this.register();this.init(a,b)}
juic.extend(PMConfirmStep,Component,{init:function(a,b){this._singleSelection=a;this._data=b;this._commentShown=!1;this.actionUp="up";this.actionDown="down";this.actionDelete="delete";this.confirmContentId="confirmContent_"+this.id;this.commentDomId="comment_"+this.id;this.optionDomName="routeType_"+this.id;this.optionCommentsDomId="routeType_comments_"+this.id;this.optionEditsDomId="routeType_edits_"+this.id;this._usersData=void 0;this._elements=[];this._headerDataInited=!1},toggle:function(a){a?
Util.show(this.id,!0):Util.hide(this.id)},getSelectedUserIds:function(){for(var a=[],b=0,c=this._elements.length;b<c;b++)a.push(this._elements[b].userId);return a},getBackToStepId:function(){return this._backToStepId},getSubmitParams:function(){var a=[];if(this._singleSelection){a.push({key:this._data.paramUserId,value:this._user.attributes.USERID});var b=document.getElementsByName(this.optionDomName);a.push({key:this._data.paramOption,value:this._data.hasRadioOptions?b[0].checked?b[0].value:b[1].value:
this._data.optionValue});this._commentShown&&a.push({key:this._data.paramComment,value:$(this.commentDomId).value})}return a},setData:function(a){if(this._singleSelection)this._user=a.user,this._commentShown=a.commentShown,this._backToStepId=a.backToStepId,this._renderConfirmContent();else{if(this._usersData){!this._headerDataInited&&a.headers&&(this._usersData.headers=a.headers);this._usersData.users=[];for(var b=0,c=this._elements.length;b<c;b++)this._usersData.users.push(this._elements[b].data);
a.users&&(this._usersData.users=this._usersData.users.concat(a.users))}else this._usersData=a,"undefined"==typeof this._usersData.headers?this._usersData.headers={formattedFullName:MSGS.COMMON_Name}:this._headerDataInited=!0,"undefined"==typeof this._usersData.users&&(this._usersData.users=[]);this._tableData=this._usersData.users;this._prepareHeader();this._renderUserList();this._checkSelectedUserStatus()}},_prepareHeader:function(){this._tableHeader=[];var a=this._usersData.headers;if(a)for(var b in a)a.hasOwnProperty(b)&&
this._tableHeader.push({key:b,label:a[b]})},_renderUserList:function(){var a=juic.createRenderContext();a.push('\x3ctable class\x3d"usersTable" id\x3d"',this.confirmContentId,'"\x3e');this._buildTableHeader(a);this._buildTableRows(a);a.push("\x3c/table\x3e");$(this.confirmContentId).innerHTML=a.join("")},_buildTableHeader:function(a){a.push("\x3cthead\x3e");a.push("\x3ctr\x3e");for(var b=0,c=this._tableHeader.length;b<c;b++)a.push("\x3cth\x3e"),a.push(this._tableHeader[b].label),a.push("\x3c/th\x3e");
a.push('\x3cth colspan\x3d"3" class\x3d"actionTh"\x3e',MSGS.Action,"\x3c/th\x3e");a.push("\x3c/tr\x3e");a.push("\x3c/thead\x3e")},_buildTableRows:function(a){this._elements=[];a.push("\x3ctbody\x3e");for(var b=this._tableData.length,c=0;c<b;c++)this._buildTableRow(a,this._tableData[c],b,c);a.push("\x3c/tbody\x3e")},_buildTableRow:function(a,b,c,d){var f=this.id+"_"+d;a.push('\x3ctr id\x3d"',f,'"\x3e');for(var e=0,h=this._tableHeader.length;e<h;e++){a.push("\x3ctd\x3e");if(0==e)a.push(b.formattedFullName);
else{var g=b.attributes[this._tableHeader[e].key],g=g?g:"";a.push(g)}a.push("\x3c/td\x3e")}e=this._buildActionIconCell(a,d,this.actionUp,this._hideUpIcon(d));c=this._buildActionIconCell(a,d,this.actionDown,this._hideDownIcon(d,c));d=this._buildActionIconCell(a,d,this.actionDelete,!1);a.push("\x3c/tr\x3e");this._elements.push({userId:b.attributes.USERID,data:b,domId:f,domIdUp:e,domIdDown:c,domIdDelete:d})},_buildActionIconCell:function(a,b,c,d){b=this.id+"_"+c+"_"+b;var f=c==this.actionUp?MSGS.COMMON_Move_Up:
c==this.actionDown?MSGS.COMMON_Move_Down:MSGS.COMMON_Delete;a.push('\x3ctd class\x3d"actionIcon"\x3e');a.push('\x3ca href\x3d"javascript:void(0);" id\x3d"',b,'" class\x3d"',c,'" title\x3d"',f,'"');a.push('onclick\x3d"',this.fireCode("_action",{actionType:c,domId:b}),'return false;"');d&&a.push(' style\x3d"display:none"');a.push("\x3e\x3c/a\x3e");a.push("\x3c/td\x3e");return b},_renderConfirmContent:function(){var a=juic.createRenderContext();a.push('\x3cdiv class\x3d"confirmOuter"\x3e');a.push('\x3cdiv class\x3d"confirmType"\x3e');
a.push("\x3cdiv\x3e");var b="\x3cstrong\x3e"+juic.escapeHTML(this._user.formattedFullName)+"\x3c/strong\x3e";this._data.hasRadioOptions?a.push(MSGS.get("PERFORMANCE_GET_FEEDBACK_CONFIRM_MSG",b)):this._data.optionValue==this._data.optionValueComments?a.push(MSGS.get("PERFORMANCE_GET_FEEDBACK_CONFIRM_MSG_FOR_COMMENTS",b)):this._data.optionValue==this._data.optionValueEdits&&a.push(MSGS.get("PERFORMANCE_GET_FEEDBACK_CONFIRM_MSG_FOR_EDITS",b));a.push("\x3c/div\x3e");this._data.hasRadioOptions&&(a.push("\x3cdiv\x3e",
MSGS.PERFORMANCE_GET_FEEDBACK_CONFIRM_FEEDBACK_TYPE,"\x3c/div\x3e"),a.push('\x3cinput type\x3d"radio" name\x3d"',this.optionDomName,'" value\x3d"',this._data.optionValueComments,'" id\x3d"',this.optionCommentsDomId,'" checked\x3e\x3clabel for\x3d"',this.optionCommentsDomId,'"\x3e',MSGS.GOALS_Comments,"\x3c/label\x3e"),a.push('\x3cinput type\x3d"radio" name\x3d"',this.optionDomName,'" value\x3d"',this._data.optionValueEdits,'" id\x3d"',this.optionEditsDomId,'"\x3e\x3clabel for\x3d"',this.optionEditsDomId,
'"\x3e',MSGS.PERFORMANCE_GET_FEEDBACK_CONFIRM_EDITS,"\x3c/label\x3e"));a.push("\x3c/div\x3e");a.push("\x3cdiv\x3e",MSGS.PERFORMANCE_GET_FEEDBACK_CONFIRM_ALERT_MSG,"\x3c/div\x3e");this._commentShown&&(a.push('\x3cdiv class\x3d"confirmCommentBy"\x3e',MSGS.get("PERFORMANCE_MASS_ROUTE_DIALOG_COMMENTS_BY",juic.escapeHTML(this._data.currentUserFullName)),"\x3c/div\x3e"),a.push("\x3cdiv\x3e"),a.push('\x3ctextarea id\x3d"',this.commentDomId,'"\x3e\x3c/textarea\x3e'),a.push("\x3c/div\x3e"),a.push("\x3cdiv\x3e",
MSGS.PERFORMANCE_MASS_ROUTE_DIALOG_COMMENTS_DESC,"\x3c/div\x3e"));a.push("\x3c/div\x3e");$(this.confirmContentId).innerHTML=a.join("")},renderHtml:function(a){a.push('\x3cdiv id\x3d"',this.id,'" class\x3d"pmWizardContent" style\x3d"display:none;"\x3e');a.push('\x3cdiv class\x3d"contentWrap"\x3e');a.push('\x3cdiv id\x3d"',this.confirmContentId,'"\x3e');a.push("\x3c/div\x3e");a.push("\x3c/div\x3e");a.push("\x3c/div\x3e")},_action:function(a){switch(a.actionType){case this.actionUp:this._reorder(a.domId,
!0);break;case this.actionDown:this._reorder(a.domId,!1);break;case this.actionDelete:this._delete(a.domId)}},_reorder:function(a,b){var c=this._findIndex(b?"domIdUp":"domIdDown",a),d=this._elements.length;if(1<d&&(b&&0<c||!b&&0<=c&&c<d-1)){var d=b?c-1:c,f=b?c:c+1,e=$(this._elements[d].domId);e.parentNode.insertBefore(e.nextSibling,e);this._elements[d]=this._elements.splice(f,1,this._elements[d])[0];this._adjustUpDownIcons();this._handleFocus(b?c-1:c+1,!1,b)}},_delete:function(a){a=this._findIndex("domIdDelete",
a);if(0<this._elements.length&&0<=a){var b=$(this._elements[a].domId);b.parentNode.removeChild(b);this._elements.splice(a,1);this._adjustUpDownIcons();this._handleFocus(a,!0);this._checkSelectedUserStatus()}},_findIndex:function(a,b){for(var c=0,d=this._elements.length;c<d;c++)if(this._elements[c][a]==b)return c;return-1},_adjustUpDownIcons:function(){for(var a=0,b=this._elements.length;a<b;a++){var c=this._elements[a];this._hideUpIcon(a)?Util.hide(c.domIdUp):Util.show(c.domIdUp);this._hideDownIcon(a,
b)?Util.hide(c.domIdDown):Util.show(c.domIdDown)}},_hideUpIcon:function(a){return 0>=a},_hideDownIcon:function(a,b){return 1>=b||a==b-1},_checkSelectedUserStatus:function(){this.dispatch("selectedUserStatus",{noUser:0==this._elements.length})},_handleFocus:function(a,b,c){var d=this._elements.length;b?0<d&&SFDom.setFocus($(this._elements[a<=d-1?a:a-1].domIdDelete)):c?SFDom.setFocus($(this._elements[a][this._hideUpIcon(a)?"domIdDown":"domIdUp"])):SFDom.setFocus($(this._elements[a][this._hideDownIcon(a,
d)?"domIdUp":"domIdDown"]))},reset:function(){this._usersData=void 0;this._elements=[]}});function PMRecallFeedback(a,b){this.register();this.init(a,b)}
juic.extend(PMRecallFeedback,Component,{init:function(a,b){this._params=a;this._currentlyWith=b},_submitForm:function(){var a=document.forms[0],b=document.createElement("input");b.name=this._params.key;b.value=this._params.value;a.appendChild(b);a.submit()},handleEvent:function(a){"recallForm"==a.actionCommand&&this._submitForm()},renderHtml:function(a){a.push(MSGS.get("PERFORMANCE_GET_FEEDBACK_RECALL_FROM",this._currentlyWith))},show:function(){this._recallDialog&&this._recallDialog.removeEventListener("action",
this);this._recallDialog=new SFDialogBox({title:MSGS.PERFORMANCE_ROUTE_RECALL_FORM,buttons:[{label:MSGS.COMMON_Cancel,eventName:"hide",active:!1},{label:MSGS.PERFORMANCE_PM2_RECALL,eventName:"recallForm",active:!0}],content:this,width:450,closeDialogOnEsc:!0});this._recallDialog.addEventListener("action",this);this._recallDialog.showDialog(!0,document.activeElement)}});function PMRemoveSigner(a,b){this.register();this.init(a,b)}
juic.extend(PMRemoveSigner,Component,{init:function(a,b){this._data=a;this._title=b?b.title:"";this._loadingPlaceholderId=this.id+"_loadingPlaceholder";this._signerComps=[];this._signerSelectedModel=new SelectSignerModel;this._signerSelectedModel.addEventListener("selectedSignerChanged",this);this._dao=new pmRemoveSignerDao;this._dao.addEventListener("getRemovableSignerListReady",this,"_onRemovableSignerListReady");this._dao.addEventListener("removeSignerReady",this,"_onRemoveSignerReady")},show:function(){if(window.PMUSaveUtils){var a=
this;PMUSaveUtils.autoSaveForm(!0,!0,function(){a._show.call(a)})}},setData:function(a){this._tableData=a;this._signerComps=[];this._showWarningMsg();this._renderList()},renderHtml:function(a){a.push('\x3cdiv id\x3d"',this._loadingPlaceholderId,'" class\x3d"removableSignerContent"\x3e\x3cdiv class\x3d"loading"\x3e\x3c/div\x3e');a.push('\x3cdiv id\x3d"',this.id+"msg",'" class\x3d"MsgContainer"\x3e');a.push('\x3cspan id\x3d"',this.id+"dataDespMsg",'" class\x3d"isShowDataMsg"\x3e\x3c/span\x3e');a.push('\x3cdiv id\x3d"',
this.id+"selectDataMsg",'" class\x3d"selectDataMsg"\x3e\x3c/div\x3e\x3c/div\x3e');a.push('\x3cdiv id\x3d"',this.id+"signerContainer",'" class\x3d"signerContainer"\x3e');a.push("\x3c/div\x3e\x3c/div\x3e")},handleEvent:function(a){if("action"==a.type)switch(a.actionCommand){case "cancelRemoveSigner":this._destroy();break;case "removeSigner":this._doRemove()}else if("selectedSignerChanged"==a.type)a=this._signerSelectedModel.getItemsCount(),this._removeDialog.getButtonLayout().setButtonEnabled(1,!!a);
else if("change"==a.type)switch(a.changeCommand){case "signerSelected":this._checkSelectedSignerStatus(a.target)}},reset:function(){this._signerComps=[]},_show:function(){this._removeDialog&&(this._removeDialog.removeEventListener("action",this),this._removeDialog.removeEventListener("selectedSignerChange",this));this._removeDialog=new SFDialogBox({title:this._title,buttons:[{label:MSGS.COMMON_Cancel,eventName:"cancelRemoveSigner",active:!1,enabled:!0},{label:MSGS.PERFORMANCE_ROUTE_REMOVE_SIGNER_ACTION,
eventName:"removeSigner",active:!0,enabled:!1}],content:this,width:650,height:450,showCloseIcon:!0});this._removeDialog.addEventListener("action",this);this._removeDialog.addEventListener("selectedSignerChange",this);this._removeDialog.showDialog(!0,document.activeElement);this._initData()},_initData:function(){var a=this._data;this._dao.getRemovableSignerList(a.formDataId,a.currentUserId,a.currentStepId)},_onRemovableSignerListReady:function(a){this.setData(a.data)},_doRemove:function(){var a=this._getSelectedSingers(),
b=this._buildParameters();a&&0<a.length&&b&&b.pageNo&&b.folderMapId?this._dao.removeSigner(this._data.formDataId,b,a):this._destroy()},_onRemoveSignerReady:function(a){this._destroy();a&&a.data&&a.data.summary&&a.data.summary.returnURL&&(window.location.href=a.data.summary.returnURL+"_s.crb\x3d"+ajaxSecKey)},_showWarningMsg:function(){var a,b="";0==this._tableData.length?a=MSGS.PERFORMANCE_ROUTE_REMOVE_SIGNER_LIST_NORESULT:(a=MSGS.PERFORMANCE_ROUTE_REMOVE_SIGNER_WARNING_DESP,b=MSGS.PERFORMANCE_ROUTE_REMOVE_SIGNER_LIST_TOSELECT);
$(this.id+"dataDespMsg").innerHTML=a;$(this.id+"selectDataMsg").innerHTML=b},_renderList:function(){var a=juic.createRenderContext();a.push('\x3ctable class\x3d"removeSignerTable" id\x3d"',this.id+"removeSignerTable",'"\x3e');this._buildTableRows(a);a.push("\x3c/table\x3e");$(this.id+"signerContainer").innerHTML=a.join("")},_buildTableRows:function(a){a.push("\x3ctbody\x3e");for(var b=0,c=this._tableData.length;b<c;b++)a.push("\x3ctr\x3e"),this._buildTableRow(a,this._tableData[b]),a.push("\x3c/tr\x3e");
a.push("\x3c/tbody\x3e")},_buildTableRow:function(a,b){a.push("\x3ctd\x3e");var c=new SFCheckBox(!1,b.userId,b.userName,"signerSelected");c.setEnabled(!0);c.addEventListener("change",this);this._signerComps.push({comp:c,data:b});c.renderHtml(a);a.push("\x3c/td\x3e")},_getSelectedSingers:function(){for(var a=[],b=0;b<this._signerComps.length;b++){var c=this._signerComps[b];c.comp.isChecked()&&c.comp.isEnabled()&&a.push(c.data)}return a},_destroy:function(){this._removeDialog&&(this.reset(),this._removeDialog.close())},
_checkSelectedSignerStatus:function(a){juic.$(a.id).checked?this._signerSelectedModel.addSelectedItem(a._value):this._signerSelectedModel.removeSelectedItem(a._value)},_buildParameters:function(){for(var a={},b={},c=["page_no","inbox_fmid"],d=0;d<c.length;d++){var f=c[d],e=document.getElementsByName(f);a[f]=e&&0<e.length?e[0].value:null}b.pageNo=a.page_no;b.folderMapId=a.inbox_fmid;return b}});function SelectSignerModel(){this._signerSelected=[]}
SelectSignerModel.prototype=function(){return set(new EventTarget,{addSelectedItem:function(a){this._signerSelected.push(a);this.dispatch("selectedSignerChanged")},removeSelectedItem:function(a){a=this._signerSelected.indexOf(a);-1<a&&this._signerSelected.splice(a,1);this.dispatch("selectedSignerChanged")},getItemsCount:function(){return this._signerSelected.length}})}();