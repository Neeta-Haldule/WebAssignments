function Activity(){this.init()}
extend(Activity,EventTarget,{init:function(){this.dao=new TranscriptDAO;this.dao.addEventListener("deleteTranscriptFromObjSuccess",this);this.dao.addEventListener("findInCatalogSuccess",this);this.activityModel=new ActivityModel(this.dao);this.activityModel.addEventListener("doEditActivity",this);this.activityModel.addEventListener("doDeleteActivity",this);this.activityModel.addEventListener("doShowMoreDetails",this);this.activityModel.addEventListener("deleteLegacyLearningActivity",this)},getModel:function(){return this.activityModel},
findInCatalog:function(a,b,c){var d=new ActivityIntegrationSFLMS(this.dao._ajaxController);d.addEventListener("action",this);a={selectedUserId:this.activityModel.getSelectedUserId(),objId:a,extURLType:b};d.findInCatalog(a,c)},createActivity:function(a){a={isNew:!0,selectedUserId:this.activityModel.getSelectedUserId(),objId:a};this._C_U_Activity(a)},deleteActivity:function(){var a={id:this.activityModel.getSelectedActivityId(),objId:this.activityModel.getSelectedObjId(),formSubjId:this.activityModel.getSelectedUserId()};
this.dao.deleteTranscriptFromObj(a)},updateActivity:function(a){a={isNew:!1,selectedUserId:this.activityModel.getSelectedUserId(),activityId:a};this._C_U_Activity(a)},_C_U_Activity:function(a){this._embedCtrl&&this._embedCtrl.cleanup();this._embedCtrl=new EmbedController(this.dao.getAjaxController(),{width:900,height:600});this._embedCtrl.setParam(a);this._embedCtrl.setFormSubjId(formConfig.subject.userId);this._embedCtrl.addEventListener("activitySaved",this);this._embedCtrl.loadData()},_showIframeDialog:function(a,
b,c){window.LEARNING_IFRAME_DIALOG?(window.LEARNING_IFRAME_DIALOG.setURL(b),window.LEARNING_IFRAME_DIALOG.setButtons(c)):(window.LEARNING_IFRAME_DIALOG=new LMSIframeDialog({width:970,height:500,url:b,buttons:c,title:a}),window.LEARNING_IFRAME_DIALOG.addEventListener("action",this),window.LEARNING_IFRAME_DIALOG.setFocus());window.LEARNING_IFRAME_DIALOG.show()},loadLMS:function(a){a=eval("("+a+")");if(a.success)this.activityModel.plateauEnabled?this._showIframeDialog(MSGS.DEVELOPMENT_TRANSCRIPT_FIND_DLG_TITLE,
a.lms_server_url,[{label:MSGS.COMMON_Done,eventName:"refresh",active:!0}]):(openStandardWindow(a.lms_server_url),this.notificationDialog||(this.notificationBody=new CDPHtmlSection(MSGS.DEVELOPMENT_TRANSCRIPT_FIND_DLG_BODY),this.notificationDialog=new SFDialog(MSGS.DEVELOPMENT_TRANSCRIPT_FIND_DLG_TITLE,this.notificationBody,[{label:MSGS.COMMON_Ok,eventName:"refresh",active:!0}],500,180),this.notificationDialog.addEventListener("action",callbackObj.model)),SFOverlayMgr.showOverlay(this.notificationDialog,
!0));else{var b=1==this.activityModel.extURLType?MSGS.DEVELOPMENT_TRANSCRIPT_EVENT_SEARCH_BY_COMPETENCY_FAIL:MSGS.DEVELOPMENT_TRANSCRIPT_EVENT_FIND_FAIL;a.message&&(b+="\n"+a.message);alert(b)}},handleEvent:function(a){switch(a.type){case "addActivity":switch(a.actionCommand){case "CustomLearningActivity":this.createActivity(this.activityModel.getSelectedObjId());break;case "FindInCatalog":a=EXT_URL_TYPE_CDP_FIND_IN_CATALOG;this.activityModel.setExtURLType(a);this.findInCatalog(this.activityModel.getSelectedObjId(),
a,!1);break;case "SearchByCompetency":a=EXT_URL_TYPE_CDP_SEARCH_BY_COMPETENCY,this.activityModel.setExtURLType(a),this.findInCatalog(this.activityModel.getSelectedObjId(),a,!0)}break;case "action":a.actionCommand&&"Done"==a.actionCommand&&(this.notificationDialog&&this.notificationDialog.close(),0<document.forms.length&&document.forms[0].submit());break;case "doEditActivity":this.updateActivity(this.activityModel.getSelectedActivityId());break;case "doDeleteActivity":this.deleteActivity();break;case "doShowMoreDetails":this._showIframeDialog(a.title,
a.url,a.btns);break;case "findInCatalogSuccess":this.loadLMS(a.data);break;case "activitySaved":0<document.forms.length&&document.forms[0].submit();break;case "deleteTranscriptFromObjSuccess":a=eval("("+a.data+")");a.success?0<document.forms.length&&document.forms[0].submit():alert(a.message);break;case "deleteLegacyLearningActivity":a.data.success?0<document.forms.length&&document.forms[0].submit():SFMessageBox.show({message:a.data.message,messageType:"alert",title:MSGS.COMMON_Err,width:500,scrollable:!0});
break;default:assert(!0,"not handler for event:"+a.type)}}});function ActivityModel(a){this.init(a)}
extend(ActivityModel,EventTarget,{init:function(a){this.dao=a;this.dao.addEventListener("getMoreDetailsSuccess",this);this.transcriptEnabled=!1;this.manualAddEnabled=this.plateauEnabled=!0;this.extURLType=EXT_URL_TYPE_CDP_FIND_IN_CATALOG;this.canDelete=this.canCreate=this.canEdit=!1},setLaActionPerm:function(a){a&&(this.canEdit=a.edit,this.canCreate=a.create,this.canDelete=a["delete"])},setExtURLType:function(a){this.extURLType=a},setManualAddEnabled:function(a){this.manualAddEnabled=a},setPlateauEnabled:function(a){this.plateauEnabled=
a},setTranscriptEnabled:function(a){this.transcriptEnabled=a},getSelectedUserId:function(){return this.selectedUserId},setSelectedUserId:function(a){this.selectedUserId=a},setSelectedObjId:function(a){this.selectedObjId=a},getSelectedObjId:function(){return this.selectedObjId},setSelectedActivityId:function(a){this.selectedActivityId=a},getSelectedActivityId:function(){return this.selectedActivityId},editActivity:function(a){this.setSelectedActivityId(a);this.dispatch("doEditActivity")},deleteActivity:function(a,
b,c){this.setSelectedActivityId(b);this.setSelectedObjId(a);this.doDeleteActivity()},doDeleteActivity:function(a){this.dispatch("doDeleteActivity")},getMoreDetails:function(a,b){var c={id:b,selectedUserId:this.getSelectedUserId(),planType:1};this.dao.getMoreDetails(c)},buildCreateSFLearningUrl:function(a,b,c,d){this.createSFLearningUrl="/tgmEdit?t\x3d"+a+"\x26u\x3d"+c+"\x26excPri\x3d"+b+"\x26devObjId\x3d"+d+"\x26slc%5fcomps\x3d\x26"},handleEvent:function(a){switch(a.type){case "getMoreDetailsSuccess":a=
eval("("+a.data+")"),a.success?this.dispatch("doShowMoreDetails",{title:MSGS.DEVELOPMENT_MORE_DETAILS_LABEL,url:a.detailLink,btns:[{label:MSGS.COMMON_Done,eventName:"hide",active:!0}]}):alert(a.message)}}});function PM2LearningActivity(a,b,c){this.register();this.init(a,b,c)}
PM2LearningActivity.prototype=function(){return set(new Component,{init:function(a,b,c){this.m=a;this.dataPath=b;this.sectPath=c;this.data=this.m.getData(this.dataPath);this.sectionData=this.m.getData(this.sectPath);this.activityCtrl=new Activity;this.activityModel=this.activityCtrl.getModel();this.activityModel.setSelectedUserId(formConfig.subject.userId);this.activityModel.setPlateauEnabled(this.sectionData.plateauEnabled);this.activityModel.setTranscriptEnabled(this.sectionData.transcriptEnabled);
this.activityModel.setManualAddEnabled(this.sectionData.customLearningEnabled);this.activityModel.setLaActionPerm({edit:this.sectionData.learningItemEditablePermission,create:this.sectionData.learningItemCreatePermission,"delete":this.sectionData.learningItemDeletePermission});this.sectionData.transcriptEnabled||this.activityModel.buildCreateSFLearningUrl(this.sectionData.learningTemplateId,this.sectionData.excludePrivateGoal,formConfig.currentUser.userId,this.data.itemId);this._activities=this.data.learningVOList;
this.objId=this.data.itemId;this.hasCompetency=this.data.hasCompetency;this._activityComps=[];for(a=0;a<this._activities.length;a++)b=new LearningActivityItem(this.objId,this.activityModel,this._activities[a],this.sectionData.excludePrivateGoal),b.addEventListener("rmSfLeaning",this),b.addEventListener("deleteLegacyLearningActivity",this.activityCtrl),this._activityComps.push(b);this.activityModel.transcriptEnabled&&(a=this._initContextMenu(),parentId=this.id+"_AddNew",this.contextMenu=new SFDropMenu(a,
{css:"contextMenu",content:MSGS.DEVELOPMENT_TRANSCRIPT_ADD_ACTIVITY}),this.contextMenu.addEventListener("action",this));this.addEventListener("addActivity",this.activityCtrl);this.addEventListener("editActivity",this.activityCtrl);this.addEventListener("deleteActivity",this.activityCtrl)},_initContextMenu:function(){var a=[];a.push({label:MSGS.DEVELOPMENT_TRANSCRIPT_ADD_FIND,actionCommand:"FindInCatalog",styleClass:""});this.activityModel.plateauEnabled&&5!=this.activityModel.extURLType&&this.hasCompetency&&
a.push({label:MSGS.DEVELOPMENT_TRANSCRIPT_ADD_SEARCH_BY_COMPETENCY,actionCommand:"SearchByCompetency",styleClass:""});this.activityModel.manualAddEnabled&&a.push({label:MSGS.DEVELOPMENT_TRANSCRIPT_ADD_CUSTOM,actionCommand:"CustomLearningActivity",styleClass:""});return a},renderHtml:function(a){this.activityModel.canCreate&&(this.activityModel.transcriptEnabled?(a.push('\x3ca class\x3d"addActivityLink" href\x3d"javascript:void(0)" onclick\x3d"',this.fireCode("_showDropDown"),'return false;" '),a.push(' aria-haspopup\x3d"true" id\x3d"',
this.contextMenu.id,'" role\x3d"button" \x3e')):a.push('\x3ca href\x3d"#" class\x3d"addActivityLink" onclick\x3d"',this.fireCode("_click"),"; return false;",'" id\x3d"',this.id,'_AddNew"\x3e'),a.push("\x3cspan\x3e"),a.push('\x3cspan class\x3d"sapIcon addActivityIcon" title\x3d"',MSGS.DEVELOPMENT_TRANSCRIPT_ADD_ACTIVITY,'" \x3e\x26#xe058;\x3c/span\x3e'),a.push('\x3cspan class\x3d"showLink"\x3e',MSGS.DEVELOPMENT_TRANSCRIPT_ADD_ACTIVITY,"\x3c/span"),a.push("\x3c/span\x3e\x3c/a\x3e"));a.push('\x3cdiv class\x3d"clear"\x3e\x3c/div\x3e');
a.push("\x3cdiv\x3e");for(var b=0;b<this._activityComps.length;b++)this._activityComps[b].renderHtml(a),b<this._activityComps.length-1&&(a.push('\x3cdiv class\x3d"separator"\x3e'),a.push("\x3c/div\x3e"));0==this._activityComps.length&&a.push('\x3cp style\x3d"margin-top: 10px; color:#888888;"\x3e',MSGS.PERFORMANCE_PM2_YOU_HAVE_NO_LEARNING_ACTIVITIES,"\x3c/p\x3e");a.push("\x3c/div\x3e")},_showDropDown:function(a){this.contextMenu._activateMenu(a)},_click:function(a){window.open(this.activityModel.createSFLearningUrl,
"add","height\x3d540,width\x3d700,dependent\x3dyes,resizable\x3dyes,hotkeys\x3dno")},handleEvent:function(a){switch(a.type){case "rmSfLeaning":case "action":this.activityModel.setSelectedObjId(this.objId),this.dispatch("addActivity",a)}}})}();function LearningActivityItem(a,b,c,d){this.register();this.init(a,b,c,d)}
LearningActivityItem.prototype=function(){return set(new Component,{init:function(a,b,c,d){this.objId=a;this._tm=b;this._activity=c;this.activityId=this._activity.id;this.fromCatalog=this._activity.fromCatalog;this.excludePrivateGoal=d;this.activityName=this._activity.name||"";this.activityDescription=this._activity.description||"";this._props=this._activity.properties;this.detailId=this.id+"_detail";this.toggleId=this.id+"_toggle";this.expanded=!1;this.fields=[];this.leftColumnData=[];this.rightColumnData=
[];this.isLeftColumnData=!0;this._prepareDataElements();this._tm.transcriptEnabled&&(this.nameLink=this._tm.plateauEnabled&&this.fromCatalog?new SFLink(this.activityName,{onClick:"action",clickParam:{actionCommand:"getMoreDetails",activityId:this.activityId}}):this._tm.canEdit?new SFLink(this.activityName,{onClick:"action",clickParam:{actionCommand:"editActivity",activityId:this.activityId}}):new SFLink(this.activityName),this.nameLink.addEventListener("action",this))},_prepareDataElements:function(){var a=
this._props;if(a&&0<a.length)for(var b=!0,c=0,d=a.length;c<d;c++)b?this.leftColumnData.push(a[c]):this.rightColumnData.push(a[c]),b=b?!1:!0},_renderColumnData:function(a,b){for(var c=0,d=b.length;c<d;c++){var e=b[c];a.push('\x3ctr class\x3d"propTable"\x3e');a.push('\x3ctd class\x3d"activitylab"\x3e',juic.escapeHTML(e.label),"\x3c/td\x3e");a.push('\x3ctd class\x3d"activityval"\x3e',juic.escapeHTML(e.value,"\x3cbr/\x3e"),"\x3c/td\x3e");a.push("\x3c/tr\x3e")}},_clickEdit:function(a){this._tm.transcriptEnabled?
this._tm.editActivity(this.activityId):window.open("/tgmEdit?lId\x3d"+this.activityId+"\x26slc_comps\x3d\x26","tgmEdit"+this.activityId+"\x26excPri\x3d"+this.excludePrivateGoal,"height\x3d540,width\x3d700,dependent\x3dyes,resizable\x3dyes,hotkeys\x3dno")},_clickDelete:function(a){confirm(MSGS.DEVELOPMENT_TRANSCRIPT_DELETE_CONFIRM)&&(this._tm.transcriptEnabled?this._tm.deleteActivity(this.objId,this.activityId,this.fromCatalog):(this._ajaxController=AjaxService.getMBeanInstance("legacyLAController"),
this._ajaxController.deleteLegacyLearningActivity(this.activityId,this._buildCallBackObject("deleteLegacyLearningActivity"))))},_buildCallBackObject:function(a){var b={self:this,callback:function(c){b.self.dispatch(a,{data:c})},errorHandler:function(a,d){b.self.dispatch("handleError",{msg:a})},exceptionHandler:function(a,d){b.self.dispatch("handleException",{msg:a})},timeout:22E3};return b},handleEvent:function(a){switch(a.type){case "action":switch(a.param.actionCommand){case "editActivity":this._clickEdit(a);
break;case "getMoreDetails":this._tm.getMoreDetails(this.objId,this.activityId)}}},_toggle:function(){this.expanded?(SFDom.toggleClass(this.detailId,"hide"),$(this.toggleId).innerHTML=MSGS.GOALS_EXECUTION_MAP_read_more,this.expanded=!1):(SFDom.toggleClass(this.detailId,"hide"),$(this.toggleId).innerHTML=MSGS.GOALS_EXECUTION_MAP_hide_conetent,this.expanded=!0);return!1},_handleEditSpanBtnKeyPress:function(a){var b=SFDOMEvent.getCharCode(a);if(b==SFDOMEvent.KEY_CODE.RETURN||b===SFDOMEvent.KEY_CODE.SPACE)a.preventDefault(),
this._clickEdit(a)},_handleDeleteSpanBtnKeyPress:function(a){var b=SFDOMEvent.getCharCode(a);if(b==SFDOMEvent.KEY_CODE.RETURN||b===SFDOMEvent.KEY_CODE.SPACE)a.preventDefault(),this._clickDelete(a)},renderHtml:function(a){a.push('\x3cdiv class\x3d"activityItem"\x3e');a.push("\x3cdiv\x3e");a.push('\x3cspan class\x3d"activityName"\x3e');a.push(juic.escapeHTML(this.activityName));a.push("\x3c/span\x3e");a.push('\x3cspan class\x3d"activityActionLinks"\x3e');this._tm.canEdit&&!this.fromCatalog&&(a.push("\x3cspan\x3e"),
a.push('\x3cspan tabIndex\x3d0 class\x3d"sapIcon" role\x3d"button" onKeyPress\x3d"',this.fireCode("_handleEditSpanBtnKeyPress"),'" onclick\x3d"',this.fireCode("_clickEdit"),' return false;"'),a.push(' title\x3d"',juic.escapeHTML(MSGS.get("PERFORMANCE_PM2_EDIT_LEARNING_BY_NAME",this.activityName)),'"\x3e\x26#xe038;\x3c/span\x3e'),a.push("\x3c/span\x3e"));this._tm.canDelete&&(a.push("\x3cspan\x3e"),a.push('\x3cspan tabIndex\x3d0 class\x3d"sapIcon" role\x3d"button" onKeyPress\x3d"',this.fireCode("_handleDeleteSpanBtnKeyPress"),
'" onclick\x3d"',this.fireCode("_clickDelete"),' return false;"'),a.push(' title\x3d"',juic.escapeHTML(MSGS.get("PERFORMANCE_PM2_DELETE_LEARNING_BY_NAME",this.activityName)),'"\x3e\x26#xe03d;\x3c/span\x3e'),a.push("\x3c/span\x3e"));a.push("\x3c/span\x3e");a.push("\x3c/div\x3e");a.push('\x3cdiv class\x3d"" id\x3d"',this.detailId,'"\x3e');a.push('\x3cdiv class\x3d"activityDesc"\x3e',juic.escapeHTML(this.activityDescription,"\x3cbr/\x3e"),"\x3c/div\x3e");a.push('\x3cdiv class\x3d"activityInfo"\x3e');
a.push('\x3cdiv class\x3d"leftColumn"\x3e');a.push('\x3ctable summary\x3d"',juic.escapeHTML(this.activityName),'" class\x3d"properties"\x3e');this._renderColumnData(a,this.leftColumnData);a.push("\x3c/table\x3e");a.push("\x3c/div\x3e");a.push("\x3cdiv\x3e");a.push('\x3ctable summary\x3d"',juic.escapeHTML(this.activityName),'" class\x3d"properties"\x3e');this._renderColumnData(a,this.rightColumnData);a.push("\x3c/table\x3e");a.push("\x3c/div\x3e");a.push("\x3c/div\x3e");a.push("\x3c/div\x3e");a.push("\x3c/div\x3e")}})}();