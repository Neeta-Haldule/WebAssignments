function QuickcardPeopleSearch(e,f){this.register();this._init(e,f)}QuickcardPeopleSearch.companyId=null;QuickcardPeopleSearch.enablePhotoCaching=!1;QuickcardPeopleSearch.factory=function(e,f){return new QuickcardPeopleSearch(e||null,f)};
(function(){function e(a,b){this.setExternalSearchEnabled(b.enableExternalSearch);this._super(a,b)}function f(a){this._searchControllerName=a.searchControllerName;this._source=a.source}function h(a,b){this._super(a,{pageSize:b.pageSize,mutatorClass:Util.quirksMode()?" quirksQuickcardPeopleSearch ":" quickcardPeopleSearch ",focusIndex:-1,fetchPageDelay:250,visionClasses:AccessibilityPrefs.isLowVisionEnabled()?" lowVisionType-"+AccessibilityPrefs.getLowVisionType():null,fetchPagesInOrder:!0,useGlobalMenuTheming:!1});
this._popupDelay=b.popupDelay||1;this._hideQuickcardDisplay=!!b.hideQuickcardDisplay;this._enablePhoto=b.enablePhoto;this._hideUserName=b.hideUserName||!1;this._openTimer={};this._openQcs={};this._focusIndex=null}var g=["TITLE","PHONE"];juic.extend(QuickcardPeopleSearch,SFComboBox,{_displayed:!0,_init:function(a,b){var c=new juic.Config(b,{searchControllerName:"quickcardController",autoWidth:!1,autoHeight:!1,id:"people_search",writable:"true",minimumFilterSize:2,trimQueryValue:!0,enableExternalSearch:!1,
pageSize:10,maxInputLength:3999});if((this._enableExternalSearch=!!c.enableExternalSearch)||c.fixedWidth)c.fixedWidth=c.fixedWidth||84;a=a&&"undefined"!==typeof a.userId&&"undefined"!==typeof a.name?a:"";this._popupDelay=c.popupDelay&&"number"===typeof c.popupDelay?c.popupDelay:null;this._hideQuickcardDisplay=!!c.hideQuickcardDisplay;this._hideUserName=!!c.hideUserName;var d=juic.$("autocomplete.hideUserName");d&&"true"==d.content&&(this._hideUserName=!0);this._enablePhoto=!("undefined"!==typeof c.enablePhoto&&
!1===c.enablePhoto);this._super(a,new f(c),c);this._requiresResultSpacing=!0;this._itemProvider.addEventListener("responseOrgchartCheck",this,"_orgChartEnabled");this.addEventListener("itemDetailsRequested",this,"_itemDetailsRequested");this.addEventListener("keyUp",this,"_peopleSearchKeyUp")},_orgChartEnabled:function(a){this._listSelect.setOrgChartExists(a.isOrgChartEnabled)},_isToggleRendered:function(){return!this._enableExternalSearch},_createPopup:function(a){this._footer=a;this._footer.setResponse(this.totalItems);
this._super(a)},_onItemsAvailable:function(a){this.totalItems=a;this._footer&&this._footer.setResponse(this.totalItems);this._super(a)},_itemDetailsRequested:function(a){a.item&&a.item.userId&&(a=juic.$(a.item.userId+"_QuickCard"))&&(a.focus(),window.location.hash="#"+a.name)},_peopleSearchKeyUp:function(a){var b=a.keyEvent;switch(a.keyName){case "RETURN":this._enableExternalSearch&&b.shiftKey?this._dragResizer.externalSearch():this._listSelect.getFocusItem()||this._listSelect.changeItemFocus(0);
break;case "NUMERIC":this._enableExternalSearch&&(a=SFDOMEvent.getCharCode(b),b.ctrlKey&&b.shiftKey&&50==a&&this._dragResizer.externalSearch())}},_createPopupContents:function(){return this._allowResize?(this._dragResizer=new e(this._listSelect,{dragByResizing:!0,enableExternalSearch:this._enableExternalSearch,containerCss:"quickcardDragResize"}),this._dragResizer.addEventListener("dragResize",this,"_onDragResize"),this._dragResizer.addEventListener("action",this,"dispatchEvent"),this._dragResizer):
this._listSelect},_createListSelect:function(a,b){"undefined"!==typeof this._popupDelay&&(b.popupDelay=this._popupDelay);"undefined"!==this._hideQuickcardDisplay&&(b.hideQuickcardDisplay=!!this._hideQuickcardDisplay);b.enablePhoto=!!this._enablePhoto;b.hideUserName=!!this._hideUserName;var c=new h(a,b);c.setRefocusId(this.getReferenceId());return c},_hidePopup:function(){this._super();this._listSelect.clearOpenTimer();this.hideResetButton()},_onDragResize:function(a){var b=$(this._listSelect.id+"item0");
if(b){var c=$(this._listSelect.id),d=0;c.scrollHeight>c.offsetHeight&&(d=-18);b.parentNode.style.width=a.dimension.width+d+"px"}this._super(a)},getInputValue:function(){var a=juic.$(this.getReferenceId());return a&&a.value},renderHtml:function(a){this._enableExternalSearch?(a.push('\x3cspan id\x3d"',this.id,'_container" class\x3d"',this._getExtraClasses(),'"'),this._displayed||a.push(' style\x3d"display:none;"'),a.push("\x3e"),this._renderInput(a),a.push('\x3cbutton id\x3d"',this.id,'_clear" class\x3d"global-search-clear" title\x3d"',
MSGS.COMMON_AutoComplete_Clear,'"'),a.push(' onclick\x3d"',this.fireCode("_clearSearch"),this.fireCode("setFocus"),'" type\x3d"button"\x3e\x26nbsp;\x3c/button\x3e'),a.push("\x3c/span\x3e")):this._super(a)},hideResetButton:function(){var a=this;setTimeout(function(){""==a.getInputValue()&&juic.$(a.id+"_clear")&&(juic.$(a.id+"_clear").style.display="none")},1)},_clearSearch:function(){this.setValue("");juic.$(this.id+"_clear")&&(juic.$(this.id+"_clear").style.display="none");this.dispatch("action",
{actionCommand:"hideNoResults"})},clearSearch:function(){this._clearSearch()},resetLayout:function(){},showResetButton:function(){var a=this;setTimeout(function(){""!=a.getInputValue()&&juic.$(a.id+"_clear")&&(juic.$(a.id+"_clear").style.display="block")},1)},_onItemSelected:function(a){this._super(a);this.dispatch("action",{actionCommand:"itemSelect"})},showElement:function(){var a=juic.$(this.id+"_container");a&&Util.show(a);this._displayed=!0},hideElement:function(){var a=juic.$(this.id+"_container");
a&&Util.hide(a);this._displayed=!1},_getExtraClasses:function(){return this._enableExternalSearch?"autocompspan universalAutoCompSpan":this._super()}});juic.extend(e,SFDragResizer,{setResponse:function(a){this._response=a},setExternalSearchEnabled:function(a){this._isExternalSearchEnabled=a},externalSearch:function(){this._isExternalSearchEnabled&&this.dispatch("action",{actionCommand:"externalSearch",peopleSearchString:this._response.pagination.filterValue})},renderOuterContent:function(a){this._isExternalSearchEnabled&&
0<this._response.itemCount&&a.push('\x3ca id\x3d"',this.id,'_totalCount" class\x3d"quickcardShowAll" href\x3d"javascript:void(0)" onclick\x3d"',this.fireCode("externalSearch"),'"\x3e ',MSGS.get("COMMON_QUICKCARD_SHOW_ALL",this._response.itemCount),"\x3c/a\x3e");this._super(a)}});juic.extend(f,SFAbstractItemProvider,{_getSearchController:function(){var a=this._searchController;a||(this._searchController=a=AjaxService.getMBeanInstance(this._searchControllerName));return a},getItems:function(a){juic.assert(a,
"QC People Search : param is undefined!");this.orgChartCheckComplete||this.isOrgChartEnabled();var b=a.filterValue||"",c=this,d=a.startIndex;0===d?this._lastIndexRef=0:0<this._lastIndexRef&&(d=this._lastIndexRef+1);this._getSearchController().searchUser({searchValue:b,keys:g,page:a.pageNumber,maxresults:a.pageSize,source:this._source,startIndex:d},{callback:function(b){for(var d=c._items=b.items||[],e=0;e<d.length;e++){var f=d[e];isNaN(f.indexRef)||(c._lastIndexRef=Math.max(c._lastIndexRef,f.indexRef))}c.dispatch("itemsAvailable",
{items:d,itemCount:b.totalCount,pagination:a})}})},isOrgChartEnabled:function(){var a=this;this._getSearchController().isOrgChartEnabled({callback:function(b){a.dispatch("responseOrgchartCheck",{isOrgChartEnabled:b});a.orgChartCheckComplete=!0}})},getLabel:function(a){return a&&"object"==typeof a?a.name:""},hasMore:function(a){var b=a.event.pagination,c=a.items?a.items.length:0,b=c+b.pageSize*b.pageIndex,d=a.firstPageStatus;a=a.itemCount||d&&d.itemCount||0;return 0<c&&b<a},getValue:function(a){return a&&
a.userId?a.userId:""}});juic.extend(h,SFComboListSelect,{_setItemFocus:function(a,b){this._super(a,b);this._hideQuickcardDisplay||this._showQuickcard(a,b)},setOrgChartExists:function(a){this._hideOrgChart=a},setHideUserName:function(a){this._hideUserName=!!a},_showQuickcardMouseOutProxy:function(a){this._showQuickcard(a.itemIndex,a.showState)},_showQuickcard:function(a,b){var c=this,d=juic.$(this.id+a+"_userId");b&&d&&!this._openQcs[d.value]?(d=d.value,this._openTimer[d]=setTimeout(function(){var b=
Quickcard.newInstance({userId:d,showOrgChart:c._hideOrgChart,itemIndex:a});b.addEventListener("mouseOverQC",c,"_stopHideTimer");b.addEventListener("mouseOutQC",c,"_showQuickcardMouseOutProxy");b.addEventListener("targetCleared",c,"_removeFromOpenList");c._openQcs[d]=b;b.show(c.id+a+"_userItem",!1,c._refocusId)},this._popupDelay),this.currentOpenTimer=this._openTimer[d]):b&&d&&this._openQcs[d.value]?(d=d.value,this._openTimer[d]=setTimeout(function(){c._openQcs[d].show(c.id+a+"_userItem")},this._popupDelay)):
!b&&d&&this._openQcs[d.value]?(d=d.value,this._openTimer[d]=setTimeout(function(){c._openQcs[d].dispatch("hide",{userId:d})},this._popupDelay),this.currentOpenTimer=this._openTimer[d]):d&&this._openTimer[d.value]&&clearTimeout(this._openTimer[d.value])},setRefocusId:function(a){this._refocusId=a},clearOpenTimer:function(){clearTimeout(this.currentOpenTimer);this.currentOpenTimer=null;delete this.currentOpenTimer;for(var a in this._openQcs)this._openQcs[a]&&(clearTimeout(this._openTimer[a]),this._openTimer[a]=
null,delete this._openTimer[a],this._openQcs[a].hide(),this._openQcs[a]=null),delete this._openQcs[a];this._openQcs={};this._openTimer={}},_stopHideTimer:function(a){clearTimeout(this._openTimer[a.userId])},_removeFromOpenList:function(a){a=a.target.userId;this._openQcs[a]=null;delete this._openQcs[a]},_changeItemFocus:function(a,b){var c=juic.$(this._getItemId(a));c&&Util.isMouseLeaveOrEnter(b,c)&&this.changeItemFocus(a,b)},_getItemId:function(a){return this.id+a+"_userItem"},_renderItem:function(a,
b,c){var d={urlType:SFPhoto.URL_TYPE_EDU,photoAction:"show",photoType:"quickCard",userId:b.userId};b.photoMod?d.mod=b.photoMod:b.photoId&&b.photoLastModified&&(d.mod=SFPhoto.getPhotoMod(b.photoId,b.photoLastModified));a.push('\x3cdiv class\x3d"psBlock qcpsListItem" id\x3d"',this._getItemId(c),'" onmouseover\x3d"',this.fireCode("_changeItemFocus",c),'"\x3e');a.push('\x3cinput type\x3d"hidden" id\x3d"',this.id,c,'_userId" value\x3d"',b.userId,'"/\x3e');this._enablePhoto&&a.push(new SFPhoto({userid:b.userId,
photoSrc:"string"==typeof b.photoSrc?b.photoSrc:d},{profile:"SQUARE_30"}));a.push('\x3cdiv class\x3d"psUserContent"\x3e');a.push('\x3cdiv class\x3d"topContent');(c=this.getRightDisplayText(b))?a.push('"\x3e\x3cdiv class\x3d"phoneNumber wrapText"\x3e',juic.escapeHTML(c),"\x3c/div\x3e"):a.push(' noPhoneNumber"\x3e');a.push('\x3cdiv class\x3d"primaryDisplayText wrapText" title\x3d"',this._getPrimaryDisplayTextTooltip(b),'"\x3e',this.getHighlightedText(this._filterValue,b.name),this._getUserName(b),"\x3c/div\x3e");
a.push("\x3c/div\x3e");a.push('\x3cdiv class\x3d"secondaryDisplayText wrapText"\x3e',juic.escapeHTML(this.getSecondaryDisplayText(b)),"\x3c/div\x3e");a.push("\x3c/div\x3e\x3c/div\x3e")},_getPrimaryDisplayTextTooltip:function(a){return juic.escapeHTML(a.name)+(a.userName?juic.escapeHTML(MSGS.get("COMMON_PARENTHETICAL_PHRASE",a.userName)):"")},_getUserName:function(a){return a.userName?['\x26nbsp;\x3cspan class\x3d"psdimUserName"\x3e',juic.escapeHTML(MSGS.get("COMMON_PARENTHETICAL_PHRASE",a.userName)),
"\x3c/span\x3e"]:""},getHighlightedText:function(a,b){if(!a)return juic.escapeHTML(b);var c=new RegExp(RegExp.escape(juic.escapeHTML(a)),"i");return juic.escapeHTML(b).replace(c,function(a){return"\x3cb\x3e"+a+"\x3c/b\x3e"})},getSecondaryDisplayText:function(a){return a.keys?a.keys[g[0]]:""},getRightDisplayText:function(a){return a.keys?a.keys[g[1]]:""}})})();