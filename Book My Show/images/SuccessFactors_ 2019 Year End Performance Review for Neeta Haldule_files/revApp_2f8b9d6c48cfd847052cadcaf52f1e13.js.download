function RevApp(){this.register();this.varName="formData";this.scrollTimer=-1;this.init()}
(function(){extend(RevApp,Component,{init:function(){this.dao=new RevDAO;this.isAutoSave=!1;this.loadData(this.varName);this.sectUI={};PMUSaveUtils.addEventListener("autoSaveComplete",this);this.dao.addEventListener("formInfoPodsDataReady",this);this.dao.addEventListener("supportingInformationPodDataReady",this);this.dao.addEventListener("teamRankDataReady",this);window.addEventListener?window.addEventListener("scroll",this.recordScrollPosition,!0):window.attachEvent("onscroll",this.recordScrollPosition)},
recordScrollPosition:function(){-1!==this.scrollTimer&&clearTimeout(this.scrollTimer);this.scrollTimer=window.setTimeout(function(){document.forms&&document.forms[0]&&recordScrollPosition(document.forms[0])},500)},loadData:function(a){var b=window.formConfig;b.infoPodStatusVO=window.infoPodStatusVOData;this.formHeaderData=b.formHeaderData;this.isHideRouteMap=b.hideRouteMap;assert(a,"Form data is NOT initialized in page context");this.m=new RevModel(window[a]);this.m.setDao(this.dao);this.dao.getFormInfoPods(b.folderMapId,
-1972)},processUI:function(){this.formHeaderComp=new FormHeader(this.formHeaderData);for(var a in this.m.mData){var b=this.m.mData[a];switch(b.sectType){case PMTypeUtil.SECTION_TYPE.INTRODUCTION:var c=new IntroSection(this.m,a);this.sectUI["sect_"+b.sectIndex]=c;break;case PMTypeUtil.SECTION_TYPE.USERINFO:c=new UserInfoSection(this.m,a);this.sectUI["sect_"+b.sectIndex]=c;break;case PMTypeUtil.SECTION_TYPE.REVIEWINFO:c=new ReviewInfoSection(this.m,a);this.sectUI["sect_"+b.sectIndex]=c;break;case PMTypeUtil.SECTION_TYPE.OBJECTIVE:c=
new ObjectiveSection(this.m,a);this.sectUI["sect_"+b.sectIndex]=c;break;case PMTypeUtil.SECTION_TYPE.COMPETENCY:c=new CompetencySection(this.m,a);this.sectUI["sect_"+b.sectIndex]=c;break;case PMTypeUtil.SECTION_TYPE.CUSTOM:c=new CustomSection(this.m,a);this.sectUI["sect_"+b.sectIndex]=c;break;case PMTypeUtil.SECTION_TYPE.COMPENSATION:c=new CompensationSection(this.m,a);this.sectUI["sect_"+b.sectIndex]=c;break;case PMTypeUtil.SECTION_TYPE.OBJCOMPSUMMARY:c=this._objCompSection=new ObjCompSummarySection(this.m,
a);this.sectUI["sect_"+b.sectIndex]=c;break;case PMTypeUtil.SECTION_TYPE.PERFPOTSUMMARY:c=new PerfPotSummarySection(this.m,a);this.sectUI["sect_"+b.sectIndex]=c;break;case PMTypeUtil.SECTION_TYPE.SIGNATURE:c=new SignatureSection(this.m,a);this.sectUI["sect_"+b.sectIndex]=c;break;case PMTypeUtil.SECTION_TYPE.SUMMARY:c=this._summarySection=new SummarySection(this.m,a);this.sectUI["sect_"+b.sectIndex]=c;break;case PMTypeUtil.SECTION_TYPE.JOBDESCRIPTION:c=this._jobDescriptionSection=new JobDescriptionSection(this.m,
a),this.sectUI["sect_"+b.sectIndex]=c}}if(formData.formFooterData){if(this._formFooter=new PMFormFooter(formData.formFooterData),(a=formData.formFooterData.primaryActionList)&&0<a.length)for(b=0;b<a.length;b++)if(c=a[b],"get_feedback"==c.actionType){formData.GetFeedback={label:c.displayName,enabled:c.enabled};break}}else formData.GetFeedback={label:"",enabled:!1}},handleEvent:function(a){switch(a.type){case "formInfoPodsDataReady":this.m.setData("/statistical",a.data);this.m.setData("/statistical/summarySectionVO",
globalData.summarySectionData);this.m.setData("/statistical/objCompSummarySectionVO",globalData.objCompSummarySectionData);PMStatisticalUtil.updateDataModel(this.m);this.pm2ReviewSummary&&this.pm2ReviewSummary.cleanup();this.pm2ReviewSummary=new PM2ReviewSummary(this.m);this.pm2ReviewSummary.render("formStatistics");var b=window.formConfig.infoPodStatusVO;b.teamRankPodEnabled&&this.dao.getTeamRank(formConfig.folderMapId);b.supportingInformationPodEnabled&&(this.isAutoSave&&this.supportingInformationVO?
(this.m.setData("/statistical/supportingInformationVO",this.supportingInformationVO),this.pm2ReviewSummary.refreshFeedbackComp()):this.dao.getSupportingInformationPodData(formConfig.folderMapId,formConfig.formDataId,formConfig.subject.userId,formConfig.currentUser.userId));this._summarySection&&(this._summarySection.updateRatingsWithEMOS(a.data.emosResponseVO),this._summarySection.renderAfterAutoSave(),this._summarySection.sectionDetail&&this._syncInSumSectionWeight(this._summarySection.sectionDetail._scoreDetail));
this._objCompSection&&this._objCompSection.renderAfterAutoSave();this._prepareAndRenderTableOfContents();break;case "supportingInformationPodDataReady":this.supportingInformationVO=a.data;this.m.setData("/statistical/supportingInformationVO",a.data);this.pm2ReviewSummary.refreshFeedbackComp();break;case "teamRankDataReady":this.m.setData("/statistical/teamRank",a.data);this.pm2ReviewSummary.refreshTeamRankComp();break;case "autoSaveComplete":a.success&&(this.isAutoSave=!0,this.dao.getFormInfoPods(window.formConfig.folderMapId,
this._summarySection?this._summarySection.getOverallSummaryRating():0,this.routeStepId));break;case "menuItemClicked":workflowButtonOnClickHandler(a.button)}},getCurrentStep:function(){return this.routeMapContainer._routeMap._currentStep._stepId||""},_syncInSumSectionWeight:function(a){try{if(a)for(var b=0,c=a.length;b<c;b++){var d=a[b];d&&this.m.setData("/"+d.sectionIndex+"/inSumSectionWeight/value",d.sectionWeight.value)}}catch(e){}},_prepareAndRenderTableOfContents:function(){if(!window.formConfig.tableofcontents){var a=
{},b={};a.parentId=this.pm2ReviewSummary.getTableOfContentsPlaceHolder();a.orderOfRenderingLinks=this._orderOfSections;a.mapOfFocusIdToSectObj=this._mapOfFocusIdToSectObj;b.limit=17;b.innerClassName="pm2-table-Of-contents-links-innerdiv";this._toc=new TableOfContents(a,b);this._toc.renderTableOfContents()}},render:function(){try{this.processUI();this.formHeaderComp.render("formHeader");window.formConfig.PMUnityFeatureEnabled?this.formHeaderData.ootaMessage?$("flashMsg").innerHTML=juic.escapeHTML(this.formHeaderData.ootaMessage):
$("flashMsg").style.display="none":$("flashMsg").innerHTML=MSGS.PERFORMANCE_PMU_VERSION_UNMATCHED;this._orderOfSections=[];this._mapOfFocusIdToSectObj={};if(!this.isHideRouteMap){var a=window.formDataRouteBar;a.enableStepActions=!1;this.routeMapContainer=new PMRouteMapPortlet(a);this.routeMapContainer.addEventListener("menuItemClicked",this);this.routeMapContainer.render("routeMap");this._orderOfSections.push("routeMap");this._mapOfFocusIdToSectObj.routeMap=this.routeMapContainer.getSectionTitle()}for(var b in this.sectUI){this.sectUI[b].render(b);
var c=this.sectUI[b].getFocusId();if(null!=c){this._orderOfSections.push(c);var d=this.sectUI[b].getSectionTitle();d?this._mapOfFocusIdToSectObj[c]=d:this._orderOfSections.pop()}}this._formFooter&&this._formFooter.render("footer_buttons_rev");SFFryer.addFry("formFryer");var e=this;SFFryer.addEventListener("fryStateChange",{handleEvent:function(a){e._toc&&e._toc._checkAndRenderMoreLinks()}})}catch(f){"undefined"!=typeof console&&console&&console.log&&console.log(f),alert(MSGS.COMMON_AJAX_DEFAULT_ERROR+
f.message)}}})})();function RevModel(a){JsonModel.call(this,a)}(function(){extend(RevModel,JsonModel,{setDao:function(a){this._dao=a},getDao:function(){return this._dao}})})();function RevDAO(){this._seamControllerName="formInfoPodsController";this._ajaxController=AjaxService.getMBeanInstance(this._seamControllerName);this.routeStepId=$("wfstp").value;this.routeStepId||(this.routeStepId=Util.findURLParam("wfstp"))}
(function(){extend(RevDAO,EventTarget,{getFormInfoPods:function(a,b){this._ajaxController.getFormInfoPods(a,b,this.routeStepId,this._buildCallBackObject("formInfoPodsDataReady"))},getSupportingInformationPodData:function(a,b,c,d){this._ajaxController.getSupportingInformationPodData(a,b,c,d,this.routeStepId,this._buildCallBackObject("supportingInformationPodDataReady"))},getTeamRank:function(a){this._ajaxController.getTeamRank(a,this.routeStepId,this._buildCallBackObject("teamRankDataReady"))},getRatingScaleDesc:function(a,
b){AjaxService.getMBeanInstance("ratingScaleController").getRatingScale(a,b,this._buildCallBackObject("loadRatingScaleDescSuccess"))},_buildCallBackObject:function(a){var b={self:this,callback:function(c){console.info("pmFormBarWizard callback : "+a);console.info("pmFormBarWizard data : "+c);b.self.dispatch(a,{data:c})},errorHandler:function(a,d){b.self.dispatch("handleError",{msg:a})},exceptionHandler:function(a,d){b.self.dispatch("handleException",{msg:a})},timeout:12E4};return b}})})();