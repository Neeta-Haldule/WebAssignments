function PMBehaviors(a,b){this.register();this.init(a,b)}
(function(){extend(PMBehaviors,BaseControl,{init:function(a,b){this.data=a;this.config=b;this.behaviors=this.data?this.data.behaviors:[];this.model=this.config&&this.config.model;this.weightSymbol=this.config&&this.config.weightSymbol;this.curUserId=this.data?this.data.curUserId:"";this.sectionIndex=this.data?PMPathUtil.getSectionIndex(this.data.behaviorsDataPath):"";"collapsed"==this.model?this._initCollapsedModel():"list"==this.model?this._initListModel():"read"==this.model?this._initReadModel():
"write"==this.model&&this._initWriteModel()},_initCollapsedModel:function(){this.index=this.data?this.data.index:-1;this._initRating();this._buildCalculatedRatingComp(!1)},_initListModel:function(){this._initForDesciption()},_initReadModel:function(){this.m=this.data.m;this.index=this.data?this.data.index:-1;this.ratingScalePath=this.data?this.data.ratingScalePath:"";this._initRating();this._buildCalculatedRatingComp(!1)},_initWriteModel:function(){this._initForDesciption();this.m=this.data.m;this.rteIdToIndexMap=
{};this.calculatedRatingId=this.id+"_calculatedRating";this.ratingScalePath=this.data?this.data.ratingScalePath:"";this._initRating();this._buildCalculatedRatingComp(!0)},_initForDesciption:function(){this.descExpanded=!1;this.toggleDescId=this.id+"_desc_link";this.descIdPre=this.id+"_desc_";this.STYLE_DISPLAY_NONE=' style\x3d"display:none;"'},_initRating:function(){this.ratingScaleType=this.config?this.config.ratingScaleType:"STAR";this.showRatingScaleValue=this.config&&this.config.showRatingScaleValue;
this.ratings=[];this.ratingDescs=[];if(this.data.ratingScaleValues)for(var a=0;a<this.data.ratingScaleValues.length;a++)this.ratings.push(this.data.ratingScaleValues[a].value),this.ratingDescs.push(this.data.ratingScaleValues[a].desc)},_buildCalculatedRatingComp:function(a){var b=this.data?this.data.calculatedRatingVO:{},c="undefined"!=typeof this.config.calculatedRating&&this.config.calculatedRating||this.ratingScaleType&&"DROPDOWN"==this.ratingScaleType||"undefined"!=typeof this.config.ratingScaleVO.scaleValues&&
this.config.ratingScaleVO.scaleValues&&(7<this.config.ratingScaleVO.scaleValues.length||!this.config.ratingScaleVO.showValue);if(b&&b.ratingPerm&&("read"==b.ratingPerm.name||"write"==b.ratingPerm.name)){if(c)this.calculatedRatingComp=new SFSpan(b.textRating);else{var c=[],d=[];if("undefined"!=typeof this.config.ratingScaleVO&&"undefined"!=typeof this.config.ratingScaleVO.scaleValues&&this.config.ratingScaleVO.scaleValues)for(var e=0;e<this.config.ratingScaleVO.scaleValues.length;e++)c.push(this.config.ratingScaleVO.scaleValues[e].value),
d.push(this.config.ratingScaleVO.scaleValues[e].desc);this.calculatedRatingComp=new TalentFiveRating(b.rating,{readOnly:!0,ratingValues:c,ratingDesc:d},this.config.ratingScaleVO&&this.config.ratingScaleVO.scaleType?this.config.ratingScaleVO.scaleType:null)}a&&this.bindProperty(this.m,this.data.calculatedRatingPath+"/textRating")}},getCalculatedRatingComp:function(){return this.calculatedRatingComp},renderHtml:function(a){this.behaviors&&0<this.behaviors.length&&("collapsed"==this.model?this._renderCollapsedModel(a):
"list"==this.model?this._renderListModel(a):"read"==this.model?this._renderReadModel(a):"write"==this.model&&this._renderWriteModel(a))},_renderCollapsedModel:function(a){this.calculatedRatingComp&&this.calculatedRatingComp.renderHtml(a);a.push('\x3cdiv class\x3d"behasum"\x3e');a.push(this._isCommentsProvided()?MSGS.PERFORMANCE_REVIEW_BEHAVIOR_RATING_COMMENTS_PROVIDED:MSGS.PERFORMANCE_REVIEW_BEHAVIOR_RATING);a.push("\x3c/div\x3e")},_renderListModel:function(a){if(0<this.behaviors.length){this._renderShowDescLink(a);
a.push('\x3cdiv class\x3d"behaarea" id\x3d"',this.id,'"\x3e');for(var b=0,c=this.behaviors.length;b<c;b++){var d=this.behaviors[b];a.push('\x3cdiv class\x3d"behaitem',b+1<c?" behabord":"",'"\x3e');a.push('\x3cdiv class\x3d"behaname"\x3e');a.push(juic.escapeHTML(d.itemName));a.push("\x3c/div\x3e");a.push('\x3cdiv class\x3d"behadesc" id\x3d"',this.descIdPre+d.itemId,'"',this.descExpanded?"":this.STYLE_DISPLAY_NONE,"\x3e");a.push(juic.escapeHTML(d.itemDesc));a.push("\x3c/div\x3e");a.push("\x3c/div\x3e")}a.push("\x3c/div\x3e")}},
_renderBehaviors:function(a,b){this.behaviors=a;this.h=b;for(var c=0,d=this.behaviors.length;c<d;c++){var e=this.behaviors[c],g=!0;this._renderAnchor(b,this.sectionIndex,e.itemId,e.itemName);if(e.othersRatingComments)for(var h=0,k=e.othersRatingComments.length;h<k;h++){var f=e.othersRatingComments[h];this.curUserId===f.userid&&(f.comment&&this._hasPermission(f.commentsPerm)||f.rating&&this._hasPermission(f.ratingPerm))&&(b.push('\x3cdiv class\x3d"behaim behabord"\x3e'),b.push("\x3cdiv\x3e"),b.push(juic.escapeHTML(e.itemName)),
b.push("\x3c/div\x3e"),g=!1,f.rating&&this._hasPermission(f.ratingPerm)&&(f.isShowRatingHelpIcon=this.config.isShowRatingHelpIcon,b.push('\x3cdiv class\x3d"behaitm"\x3e'),this._renderRating(b,f,!0),b.push("\x3c/div\x3e")),f.comment&&this._hasPermission(f.commentsPerm)&&(b.push('\x3cdiv class\x3d"behaitm"\x3e'),this._renderComment(b,f,!0),b.push("\x3c/div\x3e")))}!1===g&&b.push("\x3c/div\x3e")}},_renderReadModel:function(a){a.push('\x3cdiv class\x3d"beha" id\x3d"',this.id,'"\x3e');this.calculatedRatingComp&&
this.calculatedRatingComp.renderHtml(a);if(0<this.behaviors.length){for(var b=!1,c=0;c<this.behaviors.length&&!0!==b;c++)if(null!=this.behaviors[c].othersRatingComments)for(var d=this.behaviors[c].othersRatingComments.length,e=0;e<d;e++){var g=this.behaviors[c].othersRatingComments[e];this.curUserId===g.userid&&(g.comment||g.rating)&&(b=!0)}!0===b&&(a.push('\x3cdiv class\x3d"behaareatab"\x3e'),this._renderBehaviors(this.behaviors,a),a.push("\x3c/div\x3e"));a.push("\x3c/div\x3e")}},_renderWriteModel:function(a){a.push('\x3cdiv class\x3d"beha" id\x3d"',
this.id,'"\x3e');this.calculatedRatingComp&&(a.push('\x3cdiv id\x3d"',this.calculatedRatingId,'"\x3e'),this.calculatedRatingComp.renderHtml(a),a.push("\x3c/div\x3e"));if(0<this.behaviors.length){a.push("\x3cdiv\x3e");this._renderShowDescLink(a);a.push('\x3cdiv class\x3d"behaclr"\x3e\x3c/div\x3e\x3c/div\x3e');a.push('\x3cdiv class\x3d"behaarea"\x3e');for(var b=0,c=this.behaviors.length;b<c;b++){var d=this.behaviors[b];this._renderAnchor(a,this.sectionIndex,d.itemId,d.itemName);a.push('\x3cdiv class\x3d"behaim',
b+1<c?" behabord":"",'"\x3e');a.push('\x3cdiv class\x3d"behatitle"\x3e');a.push(juic.escapeHTML(d.itemName));this._renderDelete(a,d,b);a.push("\x3c/div\x3e");this._renderWeight(a,d,b);a.push('\x3cdiv class\x3d"behades" id\x3d"',this.descIdPre+d.itemId,'"',this.descExpanded?"":this.STYLE_DISPLAY_NONE,"\x3e");a.push(juic.escapeHTML(d.itemDesc));a.push("\x3c/div\x3e");var e=d.ratingOfRecord;e&&this._hasPermission(e.ratingPerm)&&(e.isShowRatingHelpIcon=this.config.isShowRatingHelpIcon,a.push('\x3cdiv class\x3d"behaitm"\x3e'),
this._renderRating(a,e,!1),a.push("\x3c/div\x3e"));(d=d.itemRatingComment)&&this._hasPermission(d.ratingPerm)&&(d.isShowRatingHelpIcon=this.config.isShowRatingHelpIcon,a.push('\x3cdiv class\x3d"behaitm"\x3e'),this._renderRating(a,d,!1),a.push("\x3c/div\x3e"));d&&this._hasPermission(d.commentsPerm)&&(a.push('\x3cdiv class\x3d"behaitm"\x3e'),this._renderComment(a,d,!1,b),a.push("\x3c/div\x3e"));a.push("\x3c/div\x3e")}a.push("\x3c/div\x3e")}a.push("\x3c/div\x3e")},_renderDelete:function(a,b,c){b.deleteButtonKey&&
(a.push('\x3cspan class\x3d"behaActionLinks"\x3e\x3cspan tabindex\x3d"0" role\x3d"button" class\x3d"sapIcon"'),a.push('aria-label\x3d"',juic.escapeHTML(MSGS.get("PERFORMANCE_PM2_DELETE_BEHAVIOR_BY_NAME",b.itemName)),'"'),a.push('title \x3d"',juic.escapeHTML(MSGS.get("PERFORMANCE_PM2_DELETE_BEHAVIOR_BY_NAME",b.itemName)),'" onclick\x3d"',this.fireCode("_delete",c),' return false;"'),a.push('onkeypress\x3d"',this.fireCode("_hanldeDeleteBehaviorOnKeyPress",c),' return false;" href\x3d"#"\x3e\x26#xe03d;\x3c/span\x3e\x3c/span\x3e'))},
_hanldeDeleteBehaviorOnKeyPress:function(a,b){var c=SFDOMEvent.getCharCode(b);if(c===SFDOMEvent.KEY_CODE.RETURN||c===SFDOMEvent.KEY_CODE.SPACE)b.preventDefault(),this._delete(a)},_renderShowDescLink:function(a){a.push('\x3cdiv class\x3d"behadesclink"\x3e');a.push('\x3ca id\x3d"',this.toggleDescId,'" href\x3d"javascript:;" onclick\x3d"',this.fireCode("_toggleBehaviorDescriptions"),' return false;" aria-expanded\x3d"',this.descExpanded?"true":"false",'"\x3e');this.descExpanded?a.push(MSGS.PERFORMANCE_REVIEW_BEHAVIOR_HIDE_DESC):
a.push(MSGS.PERFORMANCE_REVIEW_BEHAVIOR_SHOW_DESC);a.push("\x3c/a\x3e");a.push("\x3c/div\x3e")},_renderWeight:function(a,b,c){if(b=b.itemWeightVO){var d=b.permission;this._hasPermission(d)&&(a.push('\x3cdiv class\x3d"behaweight"\x3e'),b=new PM2ItemWeight(b.key,b.value,this._isWritePermission(d),!1,"behaviorWeight",this.weightSymbol),b.addEventListener("editWeights",this),b.bindProperty(this.m,this.data.behaviorsDataPath+"/"+c+"/itemWeightVO/value"),b.renderHtml(a),a.push("\x3c/div\x3e"))}},_renderRating:function(a,
b,c){var d=c?!0:!this._isWritePermission(b.ratingPerm);c=c?!1:b.ratingRequired;d=new PM2Rating(b.ratingKey,b.rating,b.textRating,{readOnly:d,ratingValues:this.ratings,ratingDesc:this.ratingDescs},this.ratingScaleType,this.showRatingScaleValue,b.expectedRating);(new PMRatingLabel(b.ratingLabel,d.id,{required:c,ratingScale:{m:this.m,path:this.ratingScalePath},isShowRatingHelpIcon:b.isShowRatingHelpIcon})).renderHtml(a);d.renderHtml(a)},_renderComment:function(a,b,c,d){if(!c&&this._isWritePermission(b.commentsPerm))if(formConfig.rte){var e=
{hideWaca:!0,hideSpellCheck:!(this.config&&this.config.spellCheckEnabled),hideLegalScan:!(this.config&&this.config.legalScanEnabled),wacaEnabled:this.config&&this.config.wacaEnabled,eleId:b.commentKey,label:b.commentLabel};c=new PM2RteWrap(b.comment,e);window[b.commentKey]=c;e.wacaEnabled&&(c.bindProperty(this.m,this.data.behaviorsDataPath+"/"+d+"/itemRatingComment/comment"),c.addEventListener("openWritingAssistant",this),this.rteIdToIndexMap[c.id]=d)}else c=new PM2PlainTextWrap(b.comment,{eleId:b.commentKey,
maxLength:4E3,rows:3,width:"100%;"}),window[b.commentKey]=c;else(d=b.comment)&&!formConfig.rte&&(d=d.replace(/\n|\r\n?/g,"\x3cbr/\x3e")),c=new PMUTextTruncate(d,{displayChars:300,defaultStr:MSGS.PERFORMANCE_REVIEW_HAS_NOT_COMMENTED_YET});c&&(b=new PM2Label(b.commentLabel,c instanceof PM2RteWrap||c instanceof PM2PlainTextWrap?c.getContentId():c.id,{required:b.commentRequired}),this._renderLabelCommentBox(a,b,c))},_renderLabelCommentBox:function(a,b,c){c.hasWACA&&c.hasWACA()?(a.push('\x3cdiv class\x3d"commentbox"\x3e\x3cdiv class\x3d"commentboxlabel"\x3e'),
b&&b.renderHtml(a),a.push("\x3c/div\x3e"),a.push('\x3cdiv class\x3d"wacaBtnContainer"\x3e'),c.getComptenySelector()&&c.getComptenySelector().renderHtml(a),c.getWACAButton()&&c.getWACAButton().renderHtml(a),a.push("\x3c/div\x3e\x3c/div\x3e")):(a.push('\x3cdiv class\x3d"commentboxlabel"\x3e'),b&&b.renderHtml(a),a.push("\x3c/div\x3e"));c.renderHtml(a)},_renderAnchor:function(a,b,c,d){a.push('\x3ca href\x3d"#" onclick\x3d"return false;" class\x3d"anchor_rel" id\x3d"anchor_',b,"_",c,'" name\x3d"anchor_',
b,"_",c,'"');a.push(' aria-hidden\x3d"true" title\x3d"',juic.escapeHTML(d),'"\x3e\x26nbsp;\x3c/a\x3e')},_toggleBehaviorDescriptions:function(){this.descExpanded=!this.descExpanded;var a;this.descExpanded?($(this.toggleDescId).innerHTML=MSGS.PERFORMANCE_REVIEW_BEHAVIOR_HIDE_DESC,a=""):($(this.toggleDescId).innerHTML=MSGS.PERFORMANCE_REVIEW_BEHAVIOR_SHOW_DESC,a="none");for(var b=0,c=this.behaviors.length;b<c;b++){var d=$(this.descIdPre+this.behaviors[b].itemId);d&&(d.style.display=a)}SFDom.toggleAriaAttribute(juic.$(this.toggleDescId),
"aria-expanded")},_hasPermission:function(a){return a&&("read"==a.name||"write"==a.name)},_isWritePermission:function(a){return a&&"write"==a.name},_isCommentsProvided:function(){if(this.behaviors)for(var a=0,b=this.behaviors.length;a<b;a++){var c=this.behaviors[a];if(c.othersRatingComments)for(var d=0,e=c.othersRatingComments.length;d<e;d++){var g=c.othersRatingComments[d];if(g&&this.curUserId==g.userid&&g.comment)return!0}}return!1},_delete:function(a){if(confirm(MSGS.Delete_Confirmation_From_Form)){window.setFormModifiedFlagTrue&&
window.setFormModifiedFlagTrue();var b=document.getElementById("hiddenSubmit");b&&(b.name=this.behaviors[a].deleteButtonKey,b.value="Remove",b.click())}},handleEvent:function(a){switch(a.type){case "openWritingAssistant":var b=this.rteIdToIndexMap[a.target.id];this.dispatch("openWritingAssistant",{behaviorIndex:b,behavior:this.behaviors[b],buttonId:a.target.getWACAButtonId()});break;case "editWeights":this.dispatch("editWeights",{weightType:a.weightType,dataPath:this.data.behaviorsDataPath})}},updateBinding:function(){if(void 0!=
this.oBinding){var a=this.oBinding.getModel(),b=this.oBinding.getPath(),a=a.getData(b);this.calculatedRatingComp.setValue(a);this.calculatedRatingComp.refresh()}}})})();